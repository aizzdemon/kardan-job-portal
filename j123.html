<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BooterSpace</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- üî• Firebase (GLOBAL ‚Äî used by navbar.js & this page) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

window.app  = initializeApp(firebaseConfig);
window.db   = getFirestore(window.app);
window.auth = getAuth(window.app);
</script>

<!-- üîπ Page Data Loader -->
<script type="module">
import { collection, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

window.addEventListener("DOMContentLoaded", async () => {
  const db = window.db;

  const featured = document.getElementById("featured-jobs");
  const govt = document.getElementById("govt-jobs");
  const updates = document.getElementById("latest-updates");
  const community = document.getElementById("community-posts");

  // FEATURED JOBS
  const f = await getDocs(query(
    collection(db,"jobs"),
    where("status","==","approved"),
    orderBy("timestamp","desc"),
    limit(4)
  ));
  featured.innerHTML = "";
  f.forEach(d=>{
    const j=d.data();
    const logo=j.companyImageUrl||`https://ui-avatars.com/api/?name=${j.company||'C'}`;
    featured.innerHTML+=`
    <a href="job-detail.html?id=${d.id}" class="block p-4 hover:bg-blue-50 border-b">
      <div class="flex items-center gap-3">
        <img src="${logo}" class="w-10 h-10 rounded">
        <div>
          <b class="text-sm">${j.title}</b>
          <p class="text-xs text-gray-500">${j.company}</p>
        </div>
      </div>
    </a>`;
  });

  // GOVT
  const g = await getDocs(query(collection(db,"govtJobs"), orderBy("timestamp","desc"), limit(4)));
  govt.innerHTML="";
  g.forEach(d=>{
    govt.innerHTML+=`<div class="p-4 border-b font-semibold">${d.data().title}</div>`;
  });

  // UPDATES
  const u = await getDocs(query(collection(db,"flashLinks"), orderBy("timestamp","desc"), limit(4)));
  updates.innerHTML="";
  u.forEach(d=>{
    const x=d.data();
    updates.innerHTML+=`<a href="${x.url}" target="_blank" class="block p-4 border-b">${x.title}</a>`;
  });

  // COMMUNITY
  const c = await getDocs(query(collection(db,"communityPosts"), orderBy("timestamp","desc"), limit(4)));
  community.innerHTML="";
  c.forEach(d=>{
    const p=d.data();
    community.innerHTML+=`
    <div class="p-4 border-b">
      <p class="text-xs text-gray-500">${p.userName||"User"}</p>
      <p>${p.content}</p>
      <p class="text-xs mt-1">üëç ${p.likes||0} üëé ${p.dislikes||0}</p>
    </div>`;
  });
});
</script>

<style>
.tab-button{padding:.5rem 1rem;border-radius:.5rem;font-weight:bold}
.tab-active{background:#3B82F6;color:white}
.tab-inactive{background:#E5E7EB;color:#555}
</style>
</head>

<body class="bg-gray-50">

<!-- Navbar -->
<div id="navbar"></div>
<script>
fetch("navbar.html").then(r=>r.text()).then(html=>{
  document.getElementById("navbar").innerHTML=html;
  const s=document.createElement("script");
  s.type="module"; s.src="navbar.js"; document.body.appendChild(s);
});
</script>

<!-- Tabs -->
<div class="max-w-7xl mx-auto mt-6 flex justify-center gap-3">
  <div id="btn-featured" class="tab-button tab-active" onclick="switchTab('featured')">Featured</div>
  <div id="btn-govt" class="tab-button tab-inactive" onclick="switchTab('govt')">Govt</div>
  <div id="btn-updates" class="tab-button tab-inactive" onclick="switchTab('updates')">Updates</div>
  <div id="btn-community" class="tab-button tab-inactive" onclick="switchTab('community')">Community</div>
</div>

<main class="max-w-7xl mx-auto p-4">
  <div id="featured" class="tab-content"><div id="featured-jobs" class="bg-white rounded shadow"></div></div>
  <div id="govt" class="tab-content hidden"><div id="govt-jobs" class="bg-white rounded shadow"></div></div>
  <div id="updates" class="tab-content hidden"><div id="latest-updates" class="bg-white rounded shadow"></div></div>
  <div id="community" class="tab-content hidden"><div id="community-posts" class="bg-white rounded shadow"></div></div>
</main>

<script>
function switchTab(tab){
  document.querySelectorAll(".tab-content").forEach(e=>e.classList.add("hidden"));
  document.querySelectorAll(".tab-button").forEach(e=>e.classList.replace("tab-active","tab-inactive"));
  document.getElementById(tab).classList.remove("hidden");
  document.getElementById("btn-"+tab).classList.replace("tab-inactive","tab-active");
}
</script>

</body>
</html>
