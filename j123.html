<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<!-- üî• Firebase (Single Init for whole site) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
import { 
  getFirestore, collection, query, where, orderBy, limit, getDocs 
} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

await signInAnonymously(auth);

window.db = db;
window.auth = auth;

/* ============ DATA LOADER ============ */
window.addEventListener("DOMContentLoaded", async () => {

  const featured = document.getElementById("featured-jobs");
  const govt = document.getElementById("govt-jobs");
  const updates = document.getElementById("latest-updates");
  const community = document.getElementById("community-posts");

  /* ---------- FEATURED JOBS ---------- */
  const q1 = query(
    collection(db,"jobs"),
    where("status","==","approved"),
    orderBy("timestamp","desc"),
    limit(4)
  );
  const snap1 = await getDocs(q1);
  featured.innerHTML="";
  snap1.forEach(doc=>{
    const j=doc.data();
    const logo=j.companyImageUrl || `https://ui-avatars.com/api/?name=${j.company}`;
    featured.innerHTML+=`
      <a href="job-detail.html?id=${doc.id}" class="block p-4 border-b hover:bg-blue-50">
        <div class="flex gap-3">
          <img src="${logo}" class="w-10 h-10 rounded">
          <div>
            <p class="font-bold text-sm">${j.title}</p>
            <p class="text-xs text-gray-500">${j.company}</p>
          </div>
        </div>
      </a>`;
  });

  /* ---------- GOVT JOBS ---------- */
  const q2 = query(collection(db,"govtJobs"),orderBy("timestamp","desc"),limit(4));
  const snap2 = await getDocs(q2);
  govt.innerHTML="";
  snap2.forEach(doc=>{
    const j=doc.data();
    govt.innerHTML+=`
      <div class="p-4 border-b">
        <p class="font-bold text-sm">${j.title}</p>
        <p class="text-xs text-orange-600">${j.companyName||'Govt'}</p>
      </div>`;
  });

  /* ---------- UPDATES ---------- */
  const q3=query(collection(db,"flashLinks"),orderBy("timestamp","desc"),limit(4));
  const snap3=await getDocs(q3);
  updates.innerHTML="";
  snap3.forEach(doc=>{
    const u=doc.data();
    updates.innerHTML+=`
      <a href="${u.url}" target="_blank" class="block p-4 border-b hover:bg-yellow-50">
        ‚ö° ${u.title}
      </a>`;
  });

  /* ---------- COMMUNITY ---------- */
  const q4=query(collection(db,"communityPosts"),orderBy("timestamp","desc"),limit(4));
  const snap4=await getDocs(q4);
  community.innerHTML="";
  snap4.forEach(doc=>{
    const p=doc.data();
    community.innerHTML+=`
      <div class="p-4 border-b">
        <p class="text-xs text-gray-500">${p.userName||"Anonymous"}</p>
        <p class="text-sm">${p.content}</p>
        <p class="text-[10px]">üëç ${p.likes||0} üëé ${p.dislikes||0}</p>
      </div>`;
  });

});
</script>

<style>
.blink-new{ animation: blink 1s infinite; }
.tab-button{ padding:.5rem 1rem;border-radius:.5rem;font-weight:600 }
.tab-active{background:#3b82f6;color:white}
.tab-inactive{background:#e5e7eb;color:#6b7280}
</style>
</head>

<body class="bg-gray-50">

<div id="navbar"></div>
<script>
fetch("navbar.html").then(r=>r.text()).then(h=>{
 document.getElementById("navbar").innerHTML=h;
 const s=document.createElement("script");s.type="module";s.src="navbar.js";document.body.appendChild(s);
});
</script>

<header class="bg-white p-6 text-center border-b">
<h1 class="text-3xl font-black">Booter<span class="text-blue-600">Space</span></h1>
</header>

<div class="flex justify-center gap-3 mt-4">
  <div id="btn-featured" class="tab-button tab-active" onclick="switchTab('featured')">Featured Jobs</div>
  <div id="btn-govt" class="tab-button tab-inactive" onclick="switchTab('govt')">Govt. Jobs</div>
  <div id="btn-updates" class="tab-button tab-inactive" onclick="switchTab('updates')">Updates</div>
  <div id="btn-community" class="tab-button tab-inactive" onclick="switchTab('community')">Community</div>
</div>

<main class="max-w-4xl mx-auto p-4">

<div id="featured" class="tab-content bg-white rounded shadow">
  <div id="featured-jobs"></div>
</div>

<div id="govt" class="tab-content hidden bg-white rounded shadow">
  <div id="govt-jobs"></div>
</div>

<div id="updates" class="tab-content hidden bg-white rounded shadow">
  <div id="latest-updates"></div>
</div>

<div id="community" class="tab-content hidden bg-white rounded shadow">
  <div id="community-posts"></div>
</div>

</main>

<script>
function switchTab(t){
  document.querySelectorAll(".tab-content").forEach(d=>d.classList.add("hidden"));
  document.getElementById(t).classList.remove("hidden");
  document.querySelectorAll(".tab-button").forEach(b=>b.className="tab-button tab-inactive");
  document.getElementById("btn-"+t).className="tab-button tab-active";
}
</script>

</body>
</html>

