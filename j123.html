<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jobs – BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<style>
.latest-badge{animation:pulse 1s infinite;}
@keyframes pulse{0%{opacity:1}50%{opacity:.4}100%{opacity:1}}
</style>

<!-- Firebase Auth -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
window.auth = auth; // expose auth for navbar.js
</script>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- Navbar -->
<div id="navbar"></div>
<script>
fetch("navbar.html").then(r=>r.text()).then(html=>{
  document.getElementById("navbar").innerHTML=html;
  const s=document.createElement("script");
  s.src="navbar.js";
  document.body.appendChild(s);
});
</script>

<!-- Header -->
<header class="bg-white border-b">
<div class="max-w-6xl mx-auto px-4 py-10 text-center">
<h1 class="text-4xl font-extrabold">Explore <span class="text-blue-600">Careers</span></h1>
<p class="text-gray-500 mt-2">Find the best jobs for you</p>

<!-- Search Bar -->
<div class="bg-white p-2 rounded-2xl shadow-xl border max-w-5xl mx-auto mt-8">
<div class="grid grid-cols-1 md:grid-cols-12 gap-2">

<!-- Keyword -->
<input id="searchInput" placeholder="Job title or company" class="md:col-span-4 p-4 rounded-xl bg-gray-50"/>

<!-- Location -->
<input id="locationInput" placeholder="Location" class="md:col-span-3 p-4 rounded-xl bg-gray-50"/>

<!-- Date Filter -->
<select id="dateFilter" class="md:col-span-3 p-4 rounded-xl bg-gray-50">
<option value="all">Any time</option>
<option value="1">24 Hours</option>
<option value="7">7 Days</option>
<option value="30">30 Days</option>
</select>

<!-- Search Button -->
<button id="mainSearchBtn" class="md:col-span-2 bg-blue-600 text-white font-bold rounded-xl">Search</button>

</div>
</div>
</div>
</header>

<!-- Jobs List -->
<main class="max-w-5xl mx-auto px-4 py-10 flex-grow">
<h2 id="jobCount" class="font-bold mb-6">Loading jobs…</h2>
<div id="jobsList" class="space-y-6"></div>
<button id="loadMoreBtn" class="hidden mt-10 bg-white border px-8 py-3 rounded-xl">Load More</button>
</main>

<!-- Firebase Firestore -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const jobsList = document.getElementById("jobsList");
const loadMoreBtn = document.getElementById("loadMoreBtn");
const jobCount = document.getElementById("jobCount");

const searchInput = document.getElementById("searchInput");
const locationInput = document.getElementById("locationInput");
const dateFilter = document.getElementById("dateFilter");
const mainSearchBtn = document.getElementById("mainSearchBtn");

let allJobs = [], filteredJobs = [], visibleJobs = [], currentIndex = 0, pageSize = 6;

// Fetch jobs
async function loadJobs() {
  const q = query(collection(db, "jobs"), where("status", "==", "approved"), orderBy("timestamp","desc"));
  const snap = await getDocs(q);
  allJobs = snap.docs.map(d => ({id:d.id, ...d.data()}));
  filteredJobs = [...allJobs];
  renderPagination();
}

// Render jobs
function renderPagination() {
  const nextBatch = filteredJobs.slice(currentIndex, currentIndex+pageSize);
  visibleJobs = visibleJobs.concat(nextBatch);
  renderJobs(visibleJobs);
  currentIndex += pageSize;
  loadMoreBtn.classList.toggle("hidden", currentIndex>=filteredJobs.length);
  jobCount.innerText = filteredJobs.length===0?"No jobs found":`${filteredJobs.length} jobs found`;
}

// Render jobs HTML
function renderJobs(jobs){
  jobsList.innerHTML = "";
  jobs.forEach(job=>{
    const logo = job.companyImageUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(job.company||"Company")}`;
    const div = document.createElement("div");
    div.className = "bg-white p-6 rounded-xl border shadow flex gap-4";
    div.innerHTML = `
      <img src="${logo}" class="w-16 h-16 rounded-xl object-cover">
      <div class="flex-1">
        <h3 class="font-bold text-lg">${job.title}</h3>
        <p class="text-sm text-gray-600">${job.company} • ${job.location||"Remote"}</p>
        <p class="text-blue-600 font-bold">${job.salary||""}</p>
      </div>
      <div class="flex flex-col gap-2">
        <button onclick="viewJob('${job.id}')" class="bg-white border px-4 py-2 rounded">View</button>
        <button onclick="applyJob('${job.id}')" class="bg-blue-600 text-white px-4 py-2 rounded">Apply</button>
      </div>
    `;
    jobsList.appendChild(div);
  });
}

// Filter jobs
function filterJobs(){
  const q = searchInput.value.toLowerCase();
  const l = locationInput.value.toLowerCase();
  const d = dateFilter.value;

  filteredJobs = allJobs.filter(job => {
    const t = (job.title||"").toLowerCase();
    const c = (job.company||"").toLowerCase();
    const loc = (job.location||"").toLowerCase();
    let dateMatch = true;
    if(d!=="all" && job.timestamp){
      const diffDays = (new Date() - job.timestamp.toDate()) / (1000*60*60*24);
      dateMatch = diffDays <= parseInt(d);
    }
    return (t.includes(q) || c.includes(q)) && loc.includes(l) && dateMatch;
  });

  visibleJobs = [];
  currentIndex = 0;
  renderPagination();
}

// Button events
mainSearchBtn.onclick = filterJobs;
loadMoreBtn.onclick = renderPagination;

window.viewJob = id => location.href = `job-detail.html?id=${id}`;
window.applyJob = id => location.href = `job-detail.html?id=${id}`;

loadJobs();
</script>
</body>
</html>
