<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - BooterSpace</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide-static@0.263.0/dist/lucide.js"></script>
<style>
  /* Optional: loader animation */
  .animate-spin { animation: spin 1s linear infinite; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body class="bg-gray-50 font-sans">

<div id="loader" class="flex items-center justify-center min-h-screen">
  <div class="flex flex-col items-center p-6 bg-white rounded-xl shadow-lg">
    <div class="animate-spin mb-4 w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full"></div>
    <p>Loading dashboard...</p>
  </div>
</div>

<div id="app" class="hidden min-h-screen p-6 max-w-4xl mx-auto space-y-6">

  <!-- Header -->
  <header class="bg-white p-6 rounded-xl shadow-xl flex justify-between items-center border-t-4 border-indigo-600">
    <div>
      <h1 class="text-2xl font-bold text-gray-900" id="welcomeText">Welcome, User</h1>
      <p class="text-sm text-gray-500">User ID: <span id="userIdText">-</span></p>
    </div>
    <div class="flex space-x-2">
      <button id="editProfileBtn" class="px-4 py-2 border border-indigo-600 text-indigo-600 rounded hover:bg-indigo-50">Edit Profile</button>
      <button id="newJobBtn" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Post New Job</button>
    </div>
  </header>

  <!-- Profile Section -->
  <section class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500">
    <h2 class="text-xl font-bold text-gray-800 mb-2">Profile</h2>
    <p class="text-gray-600 text-sm">Display Name: <span id="profileName">-</span></p>
  </section>

  <!-- Jobs Section -->
  <section class="bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Your Posted Jobs (<span id="jobsCount">0</span>)</h2>
    <div id="jobsList" class="space-y-3">
      <!-- Jobs will appear here -->
    </div>
  </section>

</div>

<!-- Modals -->
<div id="profileModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4">
  <div class="bg-white rounded-xl p-6 w-full max-w-sm">
    <h3 class="text-lg font-bold mb-4">Edit Profile</h3>
    <input type="text" id="profileInput" placeholder="Your Name" class="w-full p-2 border rounded mb-4"/>
    <div class="flex justify-end space-x-2">
      <button onclick="closeProfileModal()" class="px-4 py-2 border rounded">Cancel</button>
      <button id="saveProfileBtn" class="px-4 py-2 bg-indigo-600 text-white rounded">Save</button>
    </div>
  </div>
</div>

<div id="jobModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4">
  <div class="bg-white rounded-xl p-6 w-full max-w-md">
    <h3 class="text-lg font-bold mb-4" id="jobModalTitle">Post New Job</h3>
    <input type="text" id="jobTitle" placeholder="Job Title" class="w-full p-2 border rounded mb-2" />
    <input type="text" id="jobCompany" placeholder="Company" class="w-full p-2 border rounded mb-2" />
    <input type="text" id="jobLocation" placeholder="Location" class="w-full p-2 border rounded mb-2" />
    <input type="url" id="jobLink" placeholder="Apply Link" class="w-full p-2 border rounded mb-2" />
    <textarea id="jobDesc" placeholder="Description" class="w-full p-2 border rounded mb-2"></textarea>
    <div class="flex justify-end space-x-2">
      <button onclick="closeJobModal()" class="px-4 py-2 border rounded">Cancel</button>
      <button id="saveJobBtn" class="px-4 py-2 bg-indigo-600 text-white rounded">Save Job</button>
    </div>
  </div>
</div>

<script>
  // ---------------- Firebase Config ----------------
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;
  let editingJobId = null;

  // ---------------- Authentication ----------------
  auth.signInAnonymously()
    .then(() => console.log("Signed in anonymously"))
    .catch(err => console.error(err));

  auth.onAuthStateChanged(user => {
    if(user){
      currentUser = user;
      document.getElementById("userIdText").innerText = user.uid;
      loadProfile();
      loadJobs();
      document.getElementById("loader").classList.add("hidden");
      document.getElementById("app").classList.remove("hidden");
    }
  });

  // ---------------- Profile ----------------
  const profileModal = document.getElementById("profileModal");
  const profileInput = document.getElementById("profileInput");
  document.getElementById("editProfileBtn").onclick = ()=>profileModal.classList.remove("hidden");
  function closeProfileModal(){ profileModal.classList.add("hidden"); }

  function loadProfile(){
    db.collection("artifacts").doc("dashboard-app").collection("users").doc(currentUser.uid).collection("profile").doc("data")
      .get()
      .then(docSnap=>{
        if(docSnap.exists){
          profileInput.value = docSnap.data().name;
          document.getElementById("profileName").innerText = docSnap.data().name;
          document.getElementById("welcomeText").innerText = "Welcome, " + docSnap.data().name;
        }
      });
  }

  document.getElementById("saveProfileBtn").onclick = ()=>{
    db.collection("artifacts").doc("dashboard-app").collection("users").doc(currentUser.uid).collection("profile").doc("data")
      .set({name: profileInput.value})
      .then(()=>{
        closeProfileModal();
        loadProfile();
        alert("Profile updated!");
      });
  };

  // ---------------- Jobs ----------------
  const jobModal = document.getElementById("jobModal");
  document.getElementById("newJobBtn").onclick = ()=>{
    editingJobId = null;
    document.getElementById("jobModalTitle").innerText = "Post New Job";
    jobTitle.value = jobCompany.value = jobLocation.value = jobLink.value = jobDesc.value = "";
    jobModal.classList.remove("hidden");
  };
  function closeJobModal(){ jobModal.classList.add("hidden"); }

  function loadJobs(){
    db.collection("artifacts").doc("dashboard-app").collection("users").doc(currentUser.uid).collection("jobs")
      .orderBy("createdAt","desc")
      .onSnapshot(snapshot=>{
        const list = document.getElementById("jobsList");
        list.innerHTML = "";
        document.getElementById("jobsCount").innerText = snapshot.size;
        snapshot.forEach(docSnap=>{
          const job = docSnap.data();
          const div = document.createElement("div");
          div.className = "p-4 border rounded flex justify-between bg-white";
          div.innerHTML = `
            <div>
              <h3 class="font-bold">${job.title}</h3>
              <p class="text-sm text-gray-500">${job.company} - ${job.location}</p>
              <a href="${job.applyLink}" target="_blank" class="text-indigo-600 text-sm">Apply Link</a>
            </div>
            <div class="flex space-x-2">
              <button onclick="editJob('${docSnap.id}')" class="text-indigo-600">Edit</button>
              <button onclick="deleteJob('${docSnap.id}')" class="text-red-600">Delete</button>
            </div>
          `;
          list.appendChild(div);
        });
      });
  }

  document.getElementById("saveJobBtn").onclick = ()=>{
    const jobData = {
      title: jobTitle.value,
      company: jobCompany.value,
      location: jobLocation.value,
      applyLink: jobLink.value,
      description: jobDesc.value,
      createdAt: firebase.firestore.Timestamp.now()
    };
    const jobsRef = db.collection("artifacts").doc("dashboard-app").collection("users").doc(currentUser.uid).collection("jobs");

    if(editingJobId){
      jobsRef.doc(editingJobId).set(jobData)
        .then(()=>{ closeJobModal(); alert("Job updated!"); });
    } else {
      jobsRef.add(jobData)
        .then(()=>{ closeJobModal(); alert("Job posted!"); });
    }
  };

  function editJob(id){
    editingJobId = id;
    const docRef = db.collection("artifacts").doc("dashboard-app").collection("users").doc(currentUser.uid).collection("jobs").doc(id);
    docRef.get().then(docSnap=>{
      if(docSnap.exists){
        const job = docSnap.data();
        jobTitle.value = job.title;
        jobCompany.value = job.company;
        jobLocation.value = job.location;
        jobLink.value = job.applyLink;
        jobDesc.value = job.description;
        document.getElementById("jobModalTitle").innerText = "Edit Job";
        jobModal.classList.remove("hidden");
      }
    });
  }

  function deleteJob(id){
    if(confirm("Are you sure to delete this job?")){
      db.collection("artifacts").doc("dashboard-app").collection("users").doc(currentUser.uid).collection("jobs").doc(id)
        .delete().then(()=>alert("Job deleted!"));
    }
  }
</script>

</body>
</html>
