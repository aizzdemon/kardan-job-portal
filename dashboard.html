<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard - BooterSpace Job Portal</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase Compat SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

</head>

<body class="bg-gray-100">

<!-- NAVBAR LOADING (Same as your original code) -->
<div id="navbar"></div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  fetch("navbar.html")
    .then((res) => res.text())
    .then((data) => {
      document.getElementById("navbar").innerHTML = data;
    })
    .catch((error) => console.error("Error loading navbar:", error));
});
</script>

<!-- DASHBOARD UI (Unchanged exactly as you gave) -->
<div class="max-w-4xl mx-auto mt-10 bg-white p-6 rounded-xl shadow-md">
  <h1 class="text-3xl font-bold text-gray-800">Welcome, <span id="userName">Loading...</span></h1>

  <div class="mt-6">
    <h2 class="text-xl font-semibold text-gray-700">Your Posted Jobs</h2>
    <div id="jobsList" class="mt-4 space-y-4">
      <p class="text-gray-500">Loading jobs...</p>
    </div>
  </div>
</div>

<!-- FIREBASE + DASHBOARD LOGIC (Fully fixed) -->
<script>
// ---------------------------
// 1. FIREBASE CONFIG
// ---------------------------
const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
  measurementId: "G-RRC3X485KQ"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();


// ---------------------------
// 2. LOAD USER PROFILE
// ---------------------------
function loadUserProfile(uid) {
  db.collection("users").doc(uid).get()
    .then(doc => {
      if (doc.exists) {
        document.getElementById("userName").innerText = doc.data().fullName ?? "User";
      } else {
        document.getElementById("userName").innerText = "User";
      }
    })
    .catch(err => console.error("User load error:", err));
}


// ---------------------------
// 3. LOAD POSTED JOBS (Working)
// ---------------------------
function loadPostedJobs(uid) {
  db.collection("jobs")
    .where("userId", "==", uid)
    .orderBy("timestamp", "desc")
    .get()
    .then(snapshot => {
      if (snapshot.empty) {
        document.getElementById("jobsList").innerHTML =
          "<p class='text-gray-500'>You haven't posted any jobs yet.</p>";
        return;
      }

      let html = "";
      snapshot.forEach(doc => {
        const job = doc.data();
        html += `
          <div class="p-4 border rounded-lg bg-gray-50 shadow">
            <h3 class="font-bold text-lg">${job.jobTitle}</h3>
            <p class="text-gray-600">${job.companyName}</p>
            <p class="text-gray-500 text-sm">${job.location}</p>

            <div class="mt-3 flex gap-3">
              <button onclick="editJob('${doc.id}')" class="px-3 py-1 bg-blue-600 text-white rounded">Edit</button>
              <button onclick="deleteJob('${doc.id}')" class="px-3 py-1 bg-red-600 text-white rounded">Delete</button>
            </div>
          </div>
        `;
      });

      document.getElementById("jobsList").innerHTML = html;
    })
    .catch(err => console.error("Job load error:", err));
}


// ---------------------------
// 4. AUTH LISTENER
// ---------------------------
auth.onAuthStateChanged(user => {
  if (user) {
    loadUserProfile(user.uid);
    loadPostedJobs(user.uid);
  } else {
    console.log("Not logged in");
    window.location.href = "login.html";
  }
});


// ---------------------------
// 5. EDIT + DELETE JOB
// ---------------------------
function editJob(id) {
  window.location.href = `edit-job.html?id=${id}`;
}

function deleteJob(id) {
  if (!confirm("Are you sure you want to delete this job?")) return;

  db.collection("jobs").doc(id).delete()
    .then(() => {
      alert("Job deleted");
      location.reload();
    })
    .catch(err => console.error("Delete error:", err));
}
</script>

</body>
</html>
