<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard - BooterSpace</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase Compat -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

</head>
<body class="bg-gray-100">

<!-- NAVBAR WILL LOAD FROM navbar.html -->
<div id="navbar"></div>

<script>
  fetch("navbar.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("navbar").innerHTML = html;
    });
</script>

<!-- Container -->
<div class="max-w-6xl mx-auto mt-10 p-4">

  <!-- User Info -->
  <div class="bg-white shadow p-6 rounded-xl mb-6">
    <h2 class="text-2xl font-bold">Welcome, <span id="userName">Loading...</span> üëã</h2>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- Left Side -->
    <div class="space-y-4">
      <div class="bg-white shadow rounded-xl p-5 text-center">
        <h4 class="text-lg font-semibold text-green-600 mb-2">Profile Management</h4>
        <p class="text-gray-500">Keep your details updated.</p>
        <button onclick="location.href='profile.html'"
          class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">‚úèÔ∏è Edit Profile</button>
      </div>

      <div class="bg-white shadow rounded-xl p-5 text-center">
        <h4 class="text-lg font-semibold text-yellow-600 mb-2">Post a Job</h4>
        <p class="text-gray-500">Share new opportunities.</p>
        <button id="openPostJob"
          class="mt-2 bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg">üìù Post Job</button>
      </div>
    </div>

    <!-- Right Side (Posted Jobs) -->
    <div class="md:col-span-2 bg-white shadow p-6 rounded-xl">
      <h3 class="text-xl font-bold mb-4">Your Posted Jobs</h3>
      <div id="postedJobs" class="space-y-3 text-gray-700">Loading...</div>
    </div>

  </div>
</div>

<!-- Job Post Popup -->
<div id="jobPopup"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white w-96 p-6 rounded-xl shadow-xl relative">

    <button onclick="closePopup()" class="absolute top-3 right-3 text-xl">‚úñ</button>

    <h2 class="text-xl font-semibold mb-3">Post a New Job</h2>

    <label class="block mb-1">Job Title</label>
    <input id="jobTitle" class="w-full p-2 border rounded mb-3" placeholder="e.g., Sales Manager">

    <label class="block mb-1">Location</label>
    <input id="jobLocation" class="w-full p-2 border rounded mb-3" placeholder="e.g., Mumbai">

    <label class="block mb-1">Application Link</label>
    <input id="jobLink" class="w-full p-2 border rounded mb-3" placeholder="Paste URL">

    <label class="block mb-1">Company Logo</label>
    <input type="file" id="jobLogo" class="w-full p-2 border rounded mb-3">

    <button onclick="publishJob()"
      class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg">Publish Job</button>

  </div>
</div>

<script>
// -----------------------------
// Firebase Config
// -----------------------------
const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// -----------------------------
// Load User Name
// -----------------------------
auth.onAuthStateChanged(async (user) => {
  if (!user) return;

  const doc = await db.collection("users").doc(user.uid).get();
  document.getElementById("userName").innerText =
    doc.exists ? doc.data().name : "User";

  loadPostedJobs();
});

// -----------------------------
// Open / Close Popup
// -----------------------------
document.getElementById("openPostJob").onclick = () =>
  (document.getElementById("jobPopup").classList.remove("hidden"));

function closePopup() {
  document.getElementById("jobPopup").classList.add("hidden");
}

// -----------------------------
// Publish Job
// -----------------------------
async function publishJob() {
  const title = document.getElementById("jobTitle").value.trim();
  const location = document.getElementById("jobLocation").value.trim();
  const link = document.getElementById("jobLink").value.trim();
  const logoFile = document.getElementById("jobLogo").files[0];

  if (!title || !location || !link) {
    alert("Please fill all details.");
    return;
  }

  const user = auth.currentUser;
  let logoURL = "";

  if (logoFile) {
    const ref = storage.ref(`companyLogos/${Date.now()}-${logoFile.name}`);
    await ref.put(logoFile);
    logoURL = await ref.getDownloadURL();
  }

  await db.collection("jobs").add({
    title,
    location,
    link,
    logo: logoURL,
    status: "approved",
    userId: user.uid,
    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
  });

  alert("Job Posted Successfully!");
  closePopup();
  loadPostedJobs();
}

// -----------------------------
// Load Posted Jobs
// -----------------------------
async function loadPostedJobs() {
  const user = auth.currentUser;
  const jobsDiv = document.getElementById("postedJobs");
  jobsDiv.innerHTML = "Loading...";

  const snap = await db.collection("jobs")
    .where("userId", "==", user.uid)
    .orderBy("timestamp", "desc")
    .get();

  if (snap.empty) {
    jobsDiv.innerHTML = "<p>No jobs posted yet.</p>";
    return;
  }

  jobsDiv.innerHTML = "";

  snap.forEach(doc => {
    const job = doc.data();

    jobsDiv.innerHTML += `
      <div class="p-4 border rounded-xl shadow flex justify-between">
        <div>
          <h4 class="font-semibold text-lg">${job.title}</h4>
          <p class="text-gray-500">${job.location}</p>
        </div>
      </div>
    `;
  });
}

// -----------------------------
// Logout
// -----------------------------
function logoutUser() {
  auth.signOut().then(() => location.href = "login.html");
}

</script>

</body>
</html>
