<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sign Up | BooterSpace</title>

<!-- Firebase (COMPAT ‚Äì matches your project) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f8f9fa, #e0f7fa);
  margin: 0;
}
.logo {
  text-align: center;
  margin-top: 25px;
}
.logo a {
  font-size: 32px;
  font-weight: bold;
  color: #ff5733;
  text-decoration: none;
}
.container {
  max-width: 440px;
  margin: 30px auto;
  padding: 22px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}
button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 15px;
}
.primary { background:#ff5733;color:white }
.google { background:#4285F4;color:white }
.role-btn { background:#f1f1f1 }
input {
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:5px;
  border:1px solid #ccc;
}
.hidden { display:none }
.or { text-align:center; margin:12px 0; color:#777 }
.note { font-size:12px; color:#666; margin-top:8px }
</style>
</head>

<body>

<div class="logo">
  <a href="index.html">BooterSpace</a>
</div>

<div class="container">

  <!-- ROLE SELECTION -->
  <div id="roleStep">
    <h2>Who are you?</h2>
    <button class="role-btn" onclick="selectRole('jobSeeker')">üë§ Job Seeker</button>
    <button class="role-btn" onclick="selectRole('jobProvider')">üè¢ Job Provider</button>
  </div>

  <!-- SIGNUP FORM -->
  <form id="signupForm" class="hidden">
    <h2 id="formTitle"></h2>

    <input id="name" placeholder="Full Name" required />
    <input id="email" type="email" placeholder="Email" required />
    <input id="phone" placeholder="Phone Number" required />
    <input id="password" type="password" placeholder="Password" required />

    <input id="company" placeholder="Company Name (optional)" class="hidden" />
    <input id="gst" placeholder="GST Number (optional)" class="hidden" />
    <input id="pan" placeholder="Company PAN (optional)" class="hidden" />

    <button class="primary">Create Account</button>

    <div class="or">OR</div>
    <button type="button" class="google" onclick="googleSignup()">Sign up with Google</button>

    <p class="note" id="approvalNote"></p>
  </form>

</div>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
});

const auth = firebase.auth();
const db = firebase.firestore();

let selectedRole = "";

/* ROLE SELECT */
function selectRole(role) {
  selectedRole = role;
  document.getElementById("roleStep").classList.add("hidden");
  document.getElementById("signupForm").classList.remove("hidden");

  document.getElementById("formTitle").innerText =
    role === "jobSeeker" ? "Job Seeker Sign Up" : "Job Provider Sign Up";

  ["company","gst","pan"].forEach(id =>
    document.getElementById(id).classList.toggle("hidden", role !== "jobProvider")
  );

  document.getElementById("approvalNote").innerText =
    role === "jobProvider"
      ? "‚ö† Job posting will be enabled after admin approval."
      : "";
}

/* EMAIL SIGNUP */
document.getElementById("signupForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!selectedRole) {
    alert("Please select a role first");
    return;
  }

  const nameVal = document.getElementById("name").value.trim();
  const emailVal = document.getElementById("email").value.trim();
  const phoneVal = document.getElementById("phone").value.trim();
  const passwordVal = document.getElementById("password").value;

  const companyVal = document.getElementById("company").value.trim();
  const gstVal = document.getElementById("gst").value.trim();
  const panVal = document.getElementById("pan").value.trim();

  try {
    const cred = await auth.createUserWithEmailAndPassword(emailVal, passwordVal);

    await db.collection("users").doc(cred.user.uid).set({
      name: nameVal,
      email: emailVal,
      phone: phoneVal,

      role: selectedRole,
      jobPostAccess: false,

      company: selectedRole === "jobProvider" ? companyVal : "",
      gstNumber: selectedRole === "jobProvider" ? gstVal : "",
      companyPAN: selectedRole === "jobProvider" ? panVal : "",

      photoURL: cred.user.photoURL || "",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    window.location.href = "index.html";

  } catch (err) {
    alert(err.message);
  }
});

/* GOOGLE SIGNUP */
async function googleSignup() {
  if (!selectedRole) {
    alert("Please select a role first");
    return;
  }

  try {
    const provider = new firebase.auth.GoogleAuthProvider();
    const result = await auth.signInWithPopup(provider);

    await db.collection("users").doc(result.user.uid).set({
      name: result.user.displayName || "",
      email: result.user.email,
      phone: "",
      role: selectedRole,
      jobPostAccess: false,
      photoURL: result.user.photoURL || "",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    window.location.href = "index.html";

  } catch (err) {
    alert(err.message);
  }
}
</script>

</body>
</html>
