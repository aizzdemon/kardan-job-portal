<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Places to Hangout â€“ BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>

<body class="bg-gray-100">

<!-- ðŸ”¥ NAVBAR CONTAINER -->
<div id="navbar"></div>

<!-- PAGE HEADER -->
<header class="bg-purple-600 p-6 text-white text-center shadow">
  <h1 class="text-3xl font-bold">Places to Hangout</h1>
  <p class="text-sm opacity-90">Discover cafes, malls, hotels & fun places</p>
</header>

<!-- PLACES GRID -->
<div id="placesContainer" class="max-w-7xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>


<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
});

const auth = firebase.auth();
const db = firebase.firestore();
</script>

<!-- ================= LOAD NAVBAR ================= -->
<script>
fetch("navbar.html")
.then(res => res.text())
.then(html => {
  document.getElementById("navbar").innerHTML = html;
  initNavbarAuth();   // run after navbar loaded
});
</script>

<!-- ================= NAVBAR LOGIC ================= -->
<script>
function initNavbarAuth(){

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const avatar = document.getElementById("avatar");
  const logoutModal = document.getElementById("logoutModal");
  const loader = document.getElementById("loader");

  auth.onAuthStateChanged(user=>{
    if(user){
      loginBtn.classList.add("hidden");
      logoutBtn.classList.remove("hidden");

      db.collection("users").doc(user.uid).get().then(doc=>{
        if(doc.exists && doc.data().photoURL){
          avatar.src = doc.data().photoURL;
          avatar.classList.remove("hidden");
        }
      });

    }else{
      loginBtn.classList.remove("hidden");
      logoutBtn.classList.add("hidden");
      avatar.classList.add("hidden");
    }
  });

  logoutBtn.onclick = ()=> logoutModal.classList.remove("hidden");
  window.closeLogout = ()=> logoutModal.classList.add("hidden");

  window.confirmLogout = ()=>{
    loader.classList.remove("hidden");
    auth.signOut().then(()=>{
      location.href = "login.html";
    });
  };

  // Active menu
  const page = location.pathname.split("/").pop();
  document.querySelectorAll("[data-link]").forEach(link=>{
    if(link.getAttribute("href") === page){
      link.classList.add("text-purple-500","font-bold");
    }
  });
}
</script>

<!-- ================= LOAD PLACES ================= -->
<script>
async function loadPlaces(){
  const container = document.getElementById("placesContainer");
  const snapshot = await db.collection("places").get();

  container.innerHTML = "";

  snapshot.forEach(doc=>{
    const p = doc.data();
    container.innerHTML += `
    <div class="bg-white rounded shadow overflow-hidden">
      <img src="${p.image || 'https://via.placeholder.com/400x200'}" class="w-full h-48 object-cover">
      <div class="p-4">
        <h3 class="font-bold text-lg">${p.name}</h3>
        <p class="text-sm text-gray-600 mt-1">${p.description || ''}</p>
        ${p.googleMapsLink ? `<a href="${p.googleMapsLink}" target="_blank" class="text-blue-600 mt-2 inline-block">View on Google Maps</a>` : ''}
      </div>
    </div>
    `;
  });
}

loadPlaces();
</script>

</body>
</html>
