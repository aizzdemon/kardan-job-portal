<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Job Details ‚Äì BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

<!-- ================= FIREBASE v10 ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
import {
  getFirestore, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

const app = initializeApp(firebaseConfig);
window.auth = getAuth(app);
window.db = getFirestore(app);
window.serverTimestamp = serverTimestamp;
</script>

<style>
body { background:#f8fafc; font-family:'Plus Jakarta Sans',sans-serif; }
.job-card { background:#fff; border-radius:24px; box-shadow:0 10px 25px -5px rgba(0,0,0,0.05); }
.gradient-border::after {
  content:''; position:absolute; top:0; left:0; right:0;
  height:6px; background:linear-gradient(90deg,#2563eb,#60a5fa);
  border-radius:24px 24px 0 0;
}
.shimmer {
  background:linear-gradient(90deg,#f1f5f9 25%,#e2e8f0 50%,#f1f5f9 75%);
  background-size:200% 100%; animation:shimmer 1.5s infinite;
}
@keyframes shimmer { 0%{background-position:200% 0}100%{background-position:-200% 0} }
.slide { max-height:0; overflow:hidden; transition:max-height .4s ease; }
.slide.open { max-height:400px; }
.custom-modal {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.5); align-items:center; justify-content:center; z-index:1000;
}
</style>
</head>

<body class="min-h-screen bg-gray-50">

<!-- ================= NAVBAR ================= -->
<div id="navbar"></div>
<script>
fetch("navbar.html")
  .then(r=>r.text())
  .then(html=>{
    document.getElementById("navbar").innerHTML=html;
    const s=document.createElement("script");
    s.type="module"; s.src="navbar.js";
    document.body.appendChild(s);
  });
</script>

<!-- ================= MAIN ================= -->
<main class="max-w-7xl mx-auto px-4 py-10 grid grid-cols-1 lg:grid-cols-3 gap-8">

  <!-- LEFT -->
  <div class="lg:col-span-2 space-y-8">

    <!-- JOB DETAILS -->
    <div id="jobDetailsContent" class="job-card gradient-border p-6 md:p-10 relative">
      <div class="space-y-6">
        <div class="h-6 w-1/2 shimmer rounded"></div>
        <div class="h-4 w-1/3 shimmer rounded"></div>
        <div class="h-40 shimmer rounded"></div>
      </div>
    </div>

    <!-- ================= SUGGESTIONS ================= -->
    <div class="bg-white rounded-2xl shadow-md p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-lg">
          ü§ù People you may know
        </h3>
        <button onclick="loadSuggestions(true)"
          class="text-xs font-bold text-blue-600 hover:underline">
          Refresh
        </button>
      </div>

      <div id="suggestionList" class="space-y-4 text-sm">
        <p class="text-xs text-gray-400">Login to see suggestions</p>
      </div>
    </div>

  </div>

  <!-- RIGHT -->
  <div>
    <div class="bg-white rounded-2xl shadow-md p-6 sticky top-24">
      <h3 class="text-lg font-bold mb-3">
        üíô Our Mission for Job<span class="text-blue-600">Seekers</span>
      </h3>
      <p class="text-sm text-gray-600 whitespace-pre-line mb-4">
üöÄ We are building this platform with one clear mission ‚Äî to help job seekers find the right job, without any cost.
      </p>

      <button onclick="toggleFeedback()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">
        üí¨ Give Feedback
      </button>

      <div id="feedbackBox" class="slide mt-4">
        <input id="feedbackEmail" class="w-full border rounded-lg p-3 mb-2" placeholder="Your email">
        <textarea id="feedbackText" rows="3" class="w-full border rounded-lg p-3 mb-3" placeholder="Write your feedback..."></textarea>
        <button onclick="submitFeedback()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold">
          Submit
        </button>
      </div>
    </div>
  </div>
</main>

<!-- ================= LOGIC ================= -->
<script type="module">
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
import {
  doc, getDoc, getDocs, collection, setDoc, deleteDoc, addDoc
} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const auth = window.auth;
const db = window.db;
let currentUser=null;
let currentJobId=null;

onAuthStateChanged(auth,u=>{
  currentUser=u;
  if(u) loadSuggestions();
});

/* ================= SUGGESTIONS ================= */
window.loadSuggestions = async (force=false)=>{
  const list=document.getElementById("suggestionList");
  if(!currentUser) return;

  list.innerHTML='<p class="text-xs text-gray-400">Refreshing...</p>';

  const connectionsSnap=await getDocs(collection(db,"users",currentUser.uid,"connections"));
  const connectedIds=connectionsSnap.docs.map(d=>d.id);
  connectedIds.push(currentUser.uid);

  const usersSnap=await getDocs(collection(db,"users"));

  let users=usersSnap.docs
    .map(d=>({id:d.id,...d.data()}))
    .filter(u=>!connectedIds.includes(u.id));

  users.sort(()=>Math.random()-0.5);
  users=users.slice(0,5);

  if(!users.length){
    list.innerHTML='<p class="text-xs text-gray-400">No suggestions</p>';
    return;
  }

  list.innerHTML=users.map(u=>`
    <div class="flex items-center gap-3">
      <img src="${u.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(u.fullName||'User')}`}"
        class="w-8 h-8 rounded-full">
      <div class="flex-1">
        <p class="text-xs font-bold">${u.fullName||'Anonymous'}</p>
        <p class="text-[10px] text-gray-400">${u.bio||'Member'}</p>
      </div>
      <button onclick="connectUser('${u.id}')"
        class="text-blue-600 font-bold text-xs">+</button>
    </div>
  `).join("");
};

/* ================= CONNECT ================= */
window.connectUser=async(uid)=>{
  await setDoc(doc(db,"users",currentUser.uid,"connections",uid),{at:window.serverTimestamp()});
  await setDoc(doc(db,"users",uid,"connections",currentUser.uid),{at:window.serverTimestamp()});
  loadSuggestions(true);
};
</script>

</body>
</html>
