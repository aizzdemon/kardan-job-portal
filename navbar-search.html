<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Upgraded People Search</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@0.230.0/dist/lucide.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
.suggestion:hover { background:#f3f4f6; cursor:pointer; }
</style>
</head>

<body class="bg-gray-100">

<!-- ================= NAVBAR ================= -->
<nav class="bg-white shadow sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-2 flex justify-between items-center">

    <!-- Logo -->
    <a href="index.html" class="text-xl font-bold text-blue-600 flex gap-2">
      <i data-lucide="users"></i> BooterSpace
    </a>

    <!-- Desktop Nav -->
    <div class="hidden md:flex items-center gap-4">

      <!-- Search Box -->
      <div class="relative w-96 z-50">
        <div class="flex">
          <input id="searchInput"
            placeholder="Search people..."
            class="w-full border rounded-l-xl px-4 py-2 text-sm focus:outline-none" />

          <button id="searchBtn"
            class="px-4 bg-blue-600 text-white rounded-r-xl">
            <i data-lucide="search"></i>
          </button>
        </div>

        <!-- Suggestions -->
        <div id="searchSuggest"
          class="absolute left-0 right-0 bg-white border rounded-xl mt-1 hidden shadow max-h-80 overflow-y-auto z-50"></div>
      </div>

      <a href="jobs.html" class="text-sm font-medium">Jobs</a>

      <a href="dashboard.html" id="dashboardBtn"
         class="hidden text-sm font-medium">Dashboard</a>

      <a href="login.html" id="loginBtn"
         class="text-sm font-medium">Login</a>

      <a href="signup.html" id="signupBtn"
         class="hidden px-4 py-2 bg-blue-600 text-white rounded-xl text-sm">
        Sign Up
      </a>
    </div>

    <!-- Mobile Menu -->
    <button id="menuBtn" class="md:hidden">
      <i data-lucide="menu"></i>
    </button>
  </div>

  <!-- Mobile -->
  <div id="mobileMenu" class="hidden md:hidden p-4 border-t bg-white space-y-3">
    <div class="relative z-50">
      <div class="flex">
        <input id="mobileSearch"
          placeholder="Search people..."
          class="w-full border rounded-l-xl px-4 py-2 text-sm" />
        <button id="mobileSearchBtn"
          class="px-4 bg-blue-600 text-white rounded-r-xl">
          <i data-lucide="search"></i>
        </button>
      </div>

      <div id="mobileSuggest"
        class="absolute left-0 right-0 bg-white border rounded-xl mt-1 hidden shadow max-h-80 overflow-y-auto z-50"></div>
    </div>

    <a href="jobs.html">Jobs</a>
    <a href="dashboard.html" id="mDashboardBtn" class="hidden">Dashboard</a>
    <a href="login.html" id="mLoginBtn">Login</a>
    <a href="signup.html" id="mSignupBtn"
       class="hidden bg-blue-600 text-white py-2 rounded-xl text-center">
      Sign Up
    </a>
  </div>
</nav>

<!-- ================= SCRIPT ================= -->
<script>
lucide.createIcons();

/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* AUTH TOGGLE */
auth.onAuthStateChanged(user => {
  loginBtn.classList.toggle("hidden", !!user);
  signupBtn.classList.toggle("hidden", !!user);
  dashboardBtn.classList.toggle("hidden", !user);

  mLoginBtn.classList.toggle("hidden", !!user);
  mSignupBtn.classList.toggle("hidden", !!user);
  mDashboardBtn.classList.toggle("hidden", !user);
});

/* SEARCH FUNCTION */
async function searchUsers(text, box) {
  box.innerHTML = "";
  if (!text || text.length < 2) {
    box.classList.add("hidden");
    return;
  }

  const q = text.toLowerCase();
  const results = new Map();

  const queries = [
    db.collection("users").orderBy("nameLower").startAt(q).endAt(q+"\uf8ff").limit(5),
    db.collection("users").orderBy("usernameLower").startAt(q).endAt(q+"\uf8ff").limit(5),
    db.collection("users").orderBy("emailLower").startAt(q).endAt(q+"\uf8ff").limit(5)
  ];

  for (const query of queries) {
    const snap = await query.get();
    snap.forEach(doc => results.set(doc.id, doc.data()));
  }

  if (results.size === 0) {
    box.innerHTML = `<div class="px-4 py-2 text-gray-400">No users found</div>`;
  } else {
    results.forEach((u, uid) => {
      const div = document.createElement("div");
      div.className = "px-4 py-2 flex gap-3 items-center suggestion";
      div.innerHTML = `
        <img src="${u.photoURL || `https://ui-avatars.com/api/?name=${u.name}`}"
          class="w-8 h-8 rounded-full">
        <div>
          <div class="font-medium">${u.name}</div>
          <div class="text-xs text-gray-500">@${u.username || u.email}</div>
        </div>
      `;
      div.onclick = () => location.href = `profile.html?uid=${uid}`;
      box.appendChild(div);
    });
  }

  box.classList.remove("hidden");
}

/* EVENTS */
searchInput.oninput = e => searchUsers(e.target.value, searchSuggest);
searchBtn.onclick = () => searchUsers(searchInput.value, searchSuggest);

searchInput.onkeydown = e => {
  if (e.key === "Enter")
    searchUsers(searchInput.value, searchSuggest);
};

mobileSearch.oninput = e => searchUsers(e.target.value, mobileSuggest);
mobileSearchBtn.onclick = () => searchUsers(mobileSearch.value, mobileSuggest);

menuBtn.onclick = () => mobileMenu.classList.toggle("hidden");

/* CLICK OUTSIDE FIX */
document.addEventListener("click", e => {
  if (!e.target.closest(".relative")) {
    searchSuggest.classList.add("hidden");
    mobileSuggest.classList.add("hidden");
  }
});
</script>

</body>
</html>
