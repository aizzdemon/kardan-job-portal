<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard - BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<!-- ================= NAVBAR ================= -->
<nav class="bg-white shadow-md px-6 py-4">
  <div class="max-w-7xl mx-auto flex justify-between items-center">
    <h1 class="text-xl font-bold text-blue-600">BooterSpace</h1>
    <button onclick="openJobPopup()"
      class="bg-blue-600 text-white px-4 py-2 rounded">
      + Post Job
    </button>
  </div>
</nav>

<!-- ================= MAIN ================= -->
<main class="max-w-7xl mx-auto p-6">
  <h2 class="text-2xl font-semibold mb-4">Welcome to Dashboard</h2>
  <p class="text-gray-600">
    Post jobs and manage your listings.
  </p>
</main>

<!-- ================= JOB POPUP ================= -->
<div id="jobPopup"
  class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">

  <div class="bg-white w-full max-w-lg rounded-lg shadow-lg
              max-h-[85vh] overflow-y-auto p-6">

    <h2 class="text-xl font-bold mb-4">Post a Job</h2>

    <form id="jobForm" class="space-y-4">

      <input id="jobTitle" required
        type="text" placeholder="Job Title"
        class="w-full border p-2 rounded">

      <input id="company" required
        type="text" placeholder="Company Name"
        class="w-full border p-2 rounded">

      <input id="location" required
        type="text" placeholder="Location"
        class="w-full border p-2 rounded">

      <input id="salary"
        type="number" placeholder="Salary"
        class="w-full border p-2 rounded">

      <textarea id="description" required
        placeholder="Job Description"
        class="w-full border p-2 rounded h-32"></textarea>

      <div class="flex justify-between pt-2">
        <button type="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded">
          Publish Job
        </button>

        <button type="button" onclick="closeJobPopup()"
          class="bg-gray-400 px-4 py-2 rounded">
          Cancel
        </button>
      </div>

    </form>
  </div>
</div>

<!-- ================= SUCCESS POPUP ================= -->
<div id="successPopup"
  class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">

  <div class="bg-white p-6 rounded shadow-lg text-center">
    <h3 class="text-lg font-bold text-green-600">
      âœ… Job Published
    </h3>
    <button onclick="closeSuccessPopup()"
      class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">
      OK
    </button>
  </div>
</div>

<!-- ================= FIREBASE + JS ================= -->
<script type="module">
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp
} from
  "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
import {
  getAuth,
  onAuthStateChanged
} from
  "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";

/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* ===== AUTH CHECK ===== */
let currentUser = null;
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    currentUser = user;
  }
});

/* ===== POPUP FUNCTIONS ===== */
window.openJobPopup = () => {
  jobPopup.classList.remove("hidden");
  jobPopup.classList.add("flex");
};

window.closeJobPopup = () => {
  jobPopup.classList.add("hidden");
};

window.closeSuccessPopup = () => {
  successPopup.classList.add("hidden");
};

/* ===== JOB SUBMIT ===== */
jobForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!currentUser) {
    alert("Login required");
    return;
  }

  try {
    await addDoc(collection(db, "jobs"), {
      title: jobTitle.value,
      company: company.value,
      location: location.value,
      salary: salary.value,
      description: description.value,
      postedBy: currentUser.uid,
      createdAt: serverTimestamp(),
      status: "approved"
    });

    jobForm.reset();
    closeJobPopup();

    successPopup.classList.remove("hidden");
    successPopup.classList.add("flex");

  } catch (err) {
    console.error(err);
    alert("Error publishing job");
  }
});
</script>

</body>
</html>
