<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BooterSpace | Search Profiles</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-100">

<!-- üîç SEARCH BAR -->
<div class="bg-white border-b sticky top-0 z-10">
  <div class="max-w-4xl mx-auto p-4 flex gap-2">
    <input id="searchInput" type="text"
      placeholder="Search people, education, university..."
      class="flex-1 border rounded px-4 py-2 text-sm" />
    <button id="searchBtn"
      class="bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold">
      Search
    </button>
  </div>
</div>

<!-- MAIN VIEW -->
<div class="max-w-4xl mx-auto p-4 space-y-4" id="mainView">
  <div class="text-gray-400 text-center mt-10">
    Start searching to see profiles
  </div>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

/* ================= AUTH ================= */
auth.onAuthStateChanged(user => {
  currentUser = user;
});

/* ================= SEARCH ================= */
document.getElementById("searchBtn").onclick = runSearch;
document.getElementById("searchInput").onkeypress = e => {
  if (e.key === "Enter") runSearch();
};

async function runSearch() {
  const q = searchInput.value.toLowerCase().trim();
  if (!q) return;

  mainView.innerHTML = `<div class="text-center text-gray-400 py-10">Searching...</div>`;

  const snap = await db.collection("users").get();
  const users = [];

  snap.forEach(doc => {
    const u = doc.data();
    const text = `
      ${u.fullName || ""}
      ${u.education || ""}
      ${u.university || ""}
      ${u.experience || ""}
    `.toLowerCase();

    if (text.includes(q)) users.push({ id: doc.id, ...u });
  });

  renderList(users);
}

/* ================= RENDER LIST ================= */
function renderList(users) {
  mainView.innerHTML = `
    <div class="bg-white p-4 rounded border font-bold">
      Search Results (${users.length})
    </div>
  `;

  if (!users.length) {
    mainView.innerHTML += `
      <div class="bg-white p-6 rounded border text-center text-gray-500">
        No profiles found
      </div>`;
    return;
  }

  users.forEach(u => {
    mainView.innerHTML += `
      <div class="bg-white p-4 rounded border flex justify-between items-center hover:shadow">
        <div class="flex gap-4 items-center">
          <img src="${u.photoURL || 'https://i.imgur.com/6VBx3io.png'}"
            class="w-14 h-14 rounded-full border" />
          <div>
            <p class="font-bold">${u.fullName || "User"}</p>
            <p class="text-xs text-gray-500">
              ${u.education || "Professional"} ‚Ä¢ ${u.experience || ""}
            </p>
            <p class="text-xs text-gray-400">${u.university || ""}</p>
          </div>
        </div>

        <button onclick="openProfile('${u.id}')"
          class="border border-blue-600 text-blue-600 px-4 py-1.5 rounded-full text-xs font-bold">
          View
        </button>
      </div>
    `;
  });
}

/* ================= PROFILE VIEW ================= */
async function openProfile(uid) {
  const doc = await db.collection("users").doc(uid).get();
  const u = doc.data();
  const isMe = currentUser && currentUser.uid === uid;

  mainView.innerHTML = `
    <div class="bg-white p-6 rounded border">
      <button onclick="runSearch()" class="text-sm text-blue-600 mb-4">‚Üê Back</button>

      <div class="flex gap-6 items-center">
        <img src="${u.photoURL || 'https://i.imgur.com/6VBx3io.png'}"
          class="w-24 h-24 rounded-full border" />

        <div>
          <h2 class="text-xl font-bold">${u.fullName || "User"}</h2>
          <p class="text-gray-600 text-sm">${u.education || ""}</p>
          <p class="text-gray-500 text-sm">${u.university || ""}</p>
          <p class="text-gray-500 text-sm">${u.experience || ""}</p>
        </div>
      </div>

      ${isMe ? `
      <button onclick="editProfile('${uid}')"
        class="mt-6 bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold">
        Edit Profile
      </button>` : ""}
    </div>
  `;
}

/* ================= EDIT PROFILE ================= */
function editProfile(uid) {
  db.collection("users").doc(uid).get().then(doc => {
    const u = doc.data();

    mainView.innerHTML = `
      <div class="bg-white p-6 rounded border space-y-4">
        <h2 class="font-bold text-lg">Edit Profile</h2>

        <input id="name" class="w-full border p-2 rounded" placeholder="Full Name" value="${u.fullName || ""}">
        <input id="edu" class="w-full border p-2 rounded" placeholder="Education" value="${u.education || ""}">
        <input id="uni" class="w-full border p-2 rounded" placeholder="University" value="${u.university || ""}">
        <input id="exp" class="w-full border p-2 rounded" placeholder="Experience" value="${u.experience || ""}">
        <input id="photo" class="w-full border p-2 rounded" placeholder="Photo URL" value="${u.photoURL || ""}">

        <div class="flex gap-2">
          <button onclick="saveProfile('${uid}')"
            class="bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold">
            Save
          </button>
          <button onclick="openProfile('${uid}')"
            class="border px-4 py-2 rounded text-sm">
            Cancel
          </button>
        </div>
      </div>
    `;
  });
}

function saveProfile(uid) {
  db.collection("users").doc(uid).update({
    fullName: name.value,
    education: edu.value,
    university: uni.value,
    experience: exp.value,
    photoURL: photo.value
  }).then(() => openProfile(uid));
}
</script>

</body>
</html>
