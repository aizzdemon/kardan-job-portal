<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KARDAN | Profile</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
.avatar { cursor:pointer; border:3px solid transparent; transition:.2s }
.avatar:hover { transform:scale(1.05) }
.avatar.selected { border-color:#2563eb; background:#eff6ff }
</style>
</head>

<body class="bg-gray-100">

<!-- NAVBAR -->
<nav class="bg-white shadow sticky top-0 z-50">
<div class="max-w-6xl mx-auto p-4 flex justify-between items-center">
<h1 class="text-2xl font-black text-blue-600">KARDAN</h1>

<div class="flex items-center gap-2 relative">
<input id="searchInput" placeholder="Search users..."
class="bg-gray-100 px-4 py-2 rounded-full outline-none w-64">

<button onclick="triggerSearch()"
class="bg-blue-600 text-white p-2 rounded-full">
<i data-lucide="search"></i>
</button>

<div id="suggestions"
class="absolute top-12 w-full bg-white shadow rounded hidden z-50"></div>
</div>
</div>
</nav>

<!-- MAIN -->
<main class="max-w-6xl mx-auto p-6">

<!-- PROFILE VIEW -->
<div id="profileView" class="bg-white p-6 rounded-xl shadow">
<div class="flex gap-6 items-center">
<img id="profilePic" class="w-32 h-32 rounded-full border">
<div>
<h2 id="name" class="text-2xl font-bold"></h2>
<p id="email" class="text-gray-500 text-sm"></p>
<p id="age" class="text-sm text-blue-600 font-semibold"></p>
</div>
</div>

<div class="grid md:grid-cols-2 gap-4 mt-6">
<div><b>Education:</b> <span id="edu"></span></div>
<div><b>University:</b> <span id="uni"></span></div>
<div><b>Experience:</b> <span id="exp"></span></div>
<div><b>Qualifications:</b>
<ul id="quals" class="list-disc ml-5"></ul>
</div>
</div>

<button onclick="openEdit()"
class="mt-6 bg-blue-600 text-white px-6 py-2 rounded">
Edit Profile
</button>
</div>

<!-- SEARCH RESULTS -->
<div id="resultsView" class="hidden mt-6 bg-white p-6 rounded-xl shadow">
<h2 class="text-xl font-bold mb-4">Search Results</h2>
<div id="results"></div>
</div>

</main>

<!-- EDIT MODAL -->
<div id="editModal"
class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center">

<div class="bg-white w-full max-w-3xl rounded-xl p-6 max-h-[90vh] overflow-y-auto">

<h2 class="text-xl font-bold mb-4">Edit Profile</h2>

<!-- AVATARS -->
<h3 class="font-semibold mb-2">Choose Avatar (1000+)</h3>
<div id="avatarGallery"
class="grid grid-cols-6 gap-3 h-40 overflow-y-auto border p-3 rounded mb-4"></div>

<form id="editForm" class="space-y-4">

<input id="editName" class="w-full border p-2 rounded" placeholder="Full Name">

<!-- DOB -->
<div>
<label class="text-sm font-semibold">Date of Birth</label>
<input type="date" id="editDob"
class="w-full border p-2 rounded" onchange="calculateAge()">
<p id="agePreview" class="text-sm text-blue-600 mt-1"></p>
</div>

<!-- EDUCATION -->
<select id="editEdu" class="w-full border p-2 rounded">
<option value="">Select Education</option>
<option>High School</option>
<option>Bachelor's Degree</option>
<option>Master's Degree</option>
<option>PhD</option>
</select>

<input id="editUni" class="w-full border p-2 rounded"
placeholder="University / Institute Name">

<!-- EXPERIENCE -->
<select id="editExp" class="w-full border p-2 rounded">
<option value="">Experience</option>
<option>Fresher</option>
<option>1-2 Years</option>
<option>3-5 Years</option>
<option>5-10 Years</option>
<option>10+ Years</option>
</select>

<!-- QUALIFICATIONS -->
<div>
<div class="flex justify-between items-center">
<label class="font-semibold">Other Qualifications</label>
<button type="button" onclick="addQual()"
class="bg-blue-600 text-white px-3 rounded">+</button>
</div>
<div id="qualContainer" class="space-y-2 mt-2"></div>
</div>

<div class="flex gap-3">
<button class="bg-blue-600 text-white flex-1 py-2 rounded">Save</button>
<button type="button" onclick="closeEdit()" class="flex-1 border rounded">Cancel</button>
</div>

</form>
</div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
apiKey:"AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
authDomain:"kar-kardan.firebaseapp.com",
projectId:"kar-kardan"
});

const auth=firebase.auth();
const db=firebase.firestore();
const appId="kar-kardan";

let me, selectedAvatar="";
const avatarStyles=["bottts","avataaars","adventurer","pixel-art","croodles","micah","identicon","notionists","shapes","miniavs"];

/* AUTH */
auth.onAuthStateChanged(u=>{
if(u){me=u;loadProfile();loadAvatars();}
else auth.signInAnonymously();
});

const ref=id=>db.doc(`artifacts/${appId}/public/data/users/${id}`);
const users=db.collection(`artifacts/${appId}/public/data/users`);

/* PROFILE */
async function loadProfile(){
const s=await ref(me.uid).get();
if(!s.exists){
await ref(me.uid).set({
fullName:"New User",
photoURL:`https://api.dicebear.com/7.x/bottts/svg?seed=${me.uid}`,
qualifications:[]
});
return loadProfile();
}
const d=s.data();
name.textContent=d.fullName;
email.textContent=me.email||"Anonymous";
edu.textContent=d.education||"-";
uni.textContent=d.university||"-";
exp.textContent=d.experience||"-";
profilePic.src=d.photoURL;
selectedAvatar=d.photoURL;
quals.innerHTML=d.qualifications?.map(q=>`<li>${q}</li>`).join("")||"";

editName.value=d.fullName;
editEdu.value=d.education||"";
editUni.value=d.university||"";
editExp.value=d.experience||"";
editDob.value=d.dob||"";
calculateAge();
}

/* AVATARS */
function loadAvatars(){
avatarGallery.innerHTML="";
avatarStyles.forEach(s=>{
for(let i=0;i<100;i++){
const url=`https://api.dicebear.com/7.x/${s}/svg?seed=${s+i}`;
const div=document.createElement("div");
div.className="avatar p-1 bg-white rounded";
div.innerHTML=`<img src="${url}">`;
if(url===selectedAvatar)div.classList.add("selected");
div.onclick=()=>{
document.querySelectorAll(".avatar").forEach(a=>a.classList.remove("selected"));
div.classList.add("selected");
selectedAvatar=url;
};
avatarGallery.appendChild(div);
}
});
}

/* AGE */
function calculateAge(){
if(!editDob.value)return;
const dob=new Date(editDob.value);
const age=new Date().getFullYear()-dob.getFullYear();
agePreview.textContent=`Age: ${age} years`;
}

/* QUALIFICATIONS */
function addQual(){
const input=document.createElement("input");
input.className="w-full border p-2 rounded";
input.placeholder="Qualification / Degree";
qualContainer.appendChild(input);
}

/* SAVE */
editForm.onsubmit=async e=>{
e.preventDefault();
const quals=[...qualContainer.querySelectorAll("input")].map(i=>i.value).filter(Boolean);
await ref(me.uid).set({
fullName:editName.value,
dob:editDob.value,
education:editEdu.value,
university:editUni.value,
experience:editExp.value,
photoURL:selectedAvatar,
qualifications:quals
},{merge:true});
closeEdit();
loadProfile();
};

/* SEARCH */
searchInput.oninput=async()=>{
const q=searchInput.value.toLowerCase();
if(!q){suggestions.classList.add("hidden");return;}
const snap=await users.get();
let html="";
snap.forEach(d=>{
if(d.id!==me.uid && d.data().fullName.toLowerCase().includes(q)){
html+=`<div onclick="showUser('${d.id}')"
class="p-3 hover:bg-blue-50 cursor-pointer">${d.data().fullName}</div>`;
}
});
suggestions.innerHTML=html||"<div class='p-3 text-gray-400'>No users</div>";
suggestions.classList.remove("hidden");
};

function triggerSearch(){}

/* SHOW RESULT */
async function showUser(id){
suggestions.classList.add("hidden");
profileView.classList.add("hidden");
resultsView.classList.remove("hidden");
const d=(await ref(id).get()).data();
results.innerHTML=`
<div class="flex items-center gap-4">
<img src="${d.photoURL}" class="w-20 h-20 rounded-full">
<div>
<p class="font-bold">${d.fullName}</p>
<p>${d.education||"Member"}</p>
</div>
</div>`;
}

function openEdit(){editModal.classList.remove("hidden")}
function closeEdit(){editModal.classList.add("hidden")}

lucide.createIcons();
</script>

</body>
</html>
