<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BooterSpace - Job Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { 
      getFirestore,
      collection,
      query,
      where,
      orderBy,
      limit,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
      authDomain: "kar-kardan.firebaseapp.com",
      projectId: "kar-kardan",
      storageBucket: "kar-kardan.firebasestorage.app",
      messagingSenderId: "554147696994",
      appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
      measurementId: "G-RRC3X485KQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.addEventListener("DOMContentLoaded", async () => {

      const featuredContainer = document.getElementById("featured-jobs");
      const govtContainer = document.getElementById("govt-jobs");
      const latestContainer = document.getElementById("latest-updates");

      /* ==========================
          FEATURED JOBS (APPROVED)
      =========================== */
      try {
        const featuredQuery = query(
          collection(db, "jobs"),
          where("status", "==", "approved"), // ðŸ”¥ REQUIRED
          orderBy("timestamp", "desc"),
          limit(10)
        );

        const featuredSnapshot = await getDocs(featuredQuery);

        if (featuredSnapshot.empty) {
          featuredContainer.innerHTML =
            `<p class="text-gray-500 text-sm">No featured jobs available</p>`;
        }

        featuredSnapshot.forEach(doc => {
          const job = doc.data();
          const jobId = doc.id;

          const logo = job.companyImageUrl || "https://via.placeholder.com/80";

          featuredContainer.innerHTML += `
            <div class="bg-white p-4 rounded-lg shadow mb-4">
              <div class="flex items-center space-x-3">
                <img src="${logo}" class="w-12 h-12 object-contain rounded-md" />
                <div>
                  <h3 class="text-lg font-bold">${job.title}</h3>
                  <p class="text-gray-600">${job.company || job.companyName || ""}</p>
                  <p class="text-gray-500 text-sm">${job.location || ""}</p>
                </div>
              </div>
              <div class="flex space-x-2 mt-3">
                <a href="job-detail.html?id=${jobId}" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">View</a>
                <a href="job-detail.html?id=${jobId}" class="bg-green-500 text-white px-3 py-1 rounded text-sm">Apply</a>
              </div>
            </div>
          `;
        });

      } catch (err) {
        console.error("Featured jobs error:", err);
        featuredContainer.innerHTML =
          `<p class="text-red-500 text-sm">Unable to load jobs</p>`;
      }

      /* ==========================
          GOVT JOBS (PUBLIC)
      =========================== */
      const govtQuery = query(
        collection(db, "govtJobs"),
        orderBy("timestamp", "desc")
      );

      const govtSnapshot = await getDocs(govtQuery);

      govtSnapshot.forEach(doc => {
        const job = doc.data();
        const jobId = doc.id;

        const logo = job.companyImageUrl || "https://via.placeholder.com/80";

        govtContainer.innerHTML += `
          <div class="bg-white p-4 rounded-lg shadow mb-4">
            <div class="flex items-center space-x-3">
              <img src="${logo}" class="w-12 h-12 object-contain rounded-md" />
              <div>
                <h3 class="text-lg font-bold">${job.title}</h3>
                <p class="text-gray-600">${job.companyName}</p>
                <p class="text-gray-500 text-sm">${job.location}</p>
              </div>
            </div>
            <div class="flex space-x-2 mt-3">
              <a href="job-detail.html?id=${jobId}" class="bg-blue-500 text-white px-3 py-1 rounded text-sm">View</a>
              <a href="job-detail.html?id=${jobId}" class="bg-green-500 text-white px-3 py-1 rounded text-sm">Apply</a>
            </div>
          </div>
        `;
      });

      /* ==========================
          LATEST UPDATES
      =========================== */
      const latestQuery = query(
        collection(db, "flashLinks"),
        orderBy("timestamp", "desc"),
        limit(20)
      );

      const latestSnapshot = await getDocs(latestQuery);

      latestSnapshot.forEach(doc => {
        const item = doc.data();

        latestContainer.innerHTML += `
          <div class="p-3 bg-yellow-100 border border-yellow-300 rounded">
            <a href="${item.url}" target="_blank" class="text-blue-700 font-semibold hover:underline">
              ðŸ”¥ ${item.title}
            </a>
            <p class="text-gray-600 text-xs mt-1">
              ${item.timestamp ? new Date(item.timestamp.toDate()).toLocaleString() : ""}
            </p>
          </div>
        `;
      });

    });
  </script>
</head>

<body class="bg-gray-100">

  <!-- Navbar -->
  <div id="navbar"></div>
  <script>
    fetch("navbar.html")
      .then(res => res.text())
      .then(html => document.getElementById("navbar").innerHTML = html);
  </script>

  <!-- MAIN GRID -->
  <div class="max-w-7xl mx-auto mt-6 grid md:grid-cols-3 gap-6 px-3 sm:px-4">

    <div class="col-span-3 md:col-span-1">
      <h2 class="text-xl sm:text-2xl font-bold mb-4">Featured Jobs</h2>
      <div id="featured-jobs"></div>
    </div>

    <div class="col-span-3 md:col-span-1">
      <h2 class="text-xl sm:text-2xl font-bold mb-4">Govt Jobs</h2>
      <div id="govt-jobs"></div>
    </div>

    <div class="col-span-3 md:col-span-1">
      <h2 class="text-xl sm:text-2xl font-bold mb-4">Latest Updates</h2>
      <div id="latest-updates" class="space-y-3 bg-white p-4 rounded-lg shadow"></div>
    </div>

  </div>

</body>
</html>
