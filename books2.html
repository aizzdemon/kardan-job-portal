<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Books - KARDAN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* Smooth modal animation */
.modal-hidden {
  opacity: 0;
  pointer-events: none;
  transform: translateY(20px);
}
.modal-show {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}
.modal-transition {
  transition: all 0.3s ease-in-out;
}
</style>
</head>

<body class="bg-gray-100">

<!-- ðŸ”¥ NAVBAR -->
<div id="navbar"></div>
<script>
fetch("navbar.html")
  .then(r => r.text())
  .then(d => document.getElementById("navbar").innerHTML = d);
</script>

<header class="text-center py-8 font-bold text-2xl">
  ðŸ“š Explore Books
</header>

<!-- BOOK LIST -->
<main class="max-w-6xl mx-auto p-6">
  <div id="books" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    Loading books...
  </div>
</main>

<!-- ðŸ”¥ BOOK DETAIL MODAL -->
<div id="bookModal"
     class="fixed inset-0 bg-black/50 flex items-center justify-center modal-hidden modal-transition z-50">

  <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 relative">
    <button onclick="closeModal()"
      class="absolute top-3 right-3 text-gray-500 text-xl">&times;</button>

    <img id="modalImage" class="h-52 w-full object-cover rounded">
    <h2 id="modalTitle" class="mt-4 text-xl font-bold"></h2>
    <p id="modalAuthor" class="text-gray-500 mt-1"></p>
    <p id="modalPrice" class="font-semibold mt-2"></p>

    <p id="modalDesc" class="mt-3 text-gray-700 text-sm"></p>

    <a id="modalBuy"
       target="_blank"
       class="block mt-4 bg-blue-600 text-white py-2 rounded text-center">
       Buy Now
    </a>
  </div>
</div>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.appspot.com",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Modal helpers
window.openModal = function(book) {
  document.getElementById("modalImage").src = book.image;
  document.getElementById("modalTitle").innerText = book.title;
  document.getElementById("modalAuthor").innerText = book.author || "";
  document.getElementById("modalPrice").innerText = book.price;
  document.getElementById("modalDesc").innerText = book.description || "";
  document.getElementById("modalBuy").href = book.link;

  const modal = document.getElementById("bookModal");
  modal.classList.remove("modal-hidden");
  modal.classList.add("modal-show");
};

window.closeModal = function() {
  const modal = document.getElementById("bookModal");
  modal.classList.remove("modal-show");
  modal.classList.add("modal-hidden");
};

async function loadBooks() {
  const container = document.getElementById("books");

  try {
    const q = query(collection(db, "books"), orderBy("createdAt", "desc"));
    const snap = await getDocs(q);

    container.innerHTML = "";

    if (snap.empty) {
      container.innerHTML = "No books available.";
      return;
    }

    snap.forEach(doc => {
      const b = doc.data();

      container.innerHTML += `
        <div class="bg-white rounded-xl shadow p-4">
          <img src="${b.image}" class="h-44 w-full object-cover rounded">
          <h3 class="mt-2 font-bold">${b.title}</h3>
          <p class="text-sm text-gray-500">${b.author || ""}</p>
          <p class="font-semibold mt-1">${b.price}</p>

          <button
            onclick='openModal(${JSON.stringify(b).replace(/'/g, "&apos;")})'
            class="mt-3 w-full bg-gray-800 text-white py-2 rounded">
            View Details
          </button>
        </div>
      `;
    });

  } catch (e) {
    container.innerHTML = "Failed to load books.";
    console.error(e);
  }
}

loadBooks();
</script>

</body>
</html>
