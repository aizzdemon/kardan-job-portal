<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KARDAN | Professional Admin Console</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Firebase (Compat SDKs) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(226, 232, 240, 0.8); }
    .nav-link.active { background: #f1f5f9; color: #4f46e5; border-right: 4px solid #4f46e5; }
    .modal-overlay { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); transition: all 0.3s ease; }
    .stats-glow { box-shadow: 0 0 20px rgba(79, 70, 229, 0.15); border-color: #4f46e5 !important; }
    .custom-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); }
    
    /* Animation for filtered state */
    @keyframes pulse-soft {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .filter-active { animation: pulse-soft 2s infinite ease-in-out; }
  </style>
</head>
<body class="bg-[#f8fafc] min-h-screen text-slate-800">

<!-- GLOBAL MODAL -->
<div id="editUserModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
  <div class="modal-overlay absolute inset-0" onclick="closeUserModal()"></div>
  <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl relative z-10 overflow-hidden flex flex-col max-h-[90vh]">
    <div class="px-8 py-6 border-b flex justify-between items-center bg-white">
      <div>
        <h3 class="text-xl font-bold text-slate-900">User Intelligence Profile</h3>
        <p class="text-sm text-slate-500">Review and modify administrative data fields</p>
      </div>
      <button onclick="closeUserModal()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 transition text-slate-400">&times;</button>
    </div>
    <div class="p-8 overflow-y-auto bg-slate-50/50">
      <form id="editUserForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input type="hidden" id="editUserId">
        <div id="dynamicFields" class="contents">
          <!-- Populated by JS -->
        </div>
      </form>
    </div>
    <div class="px-8 py-5 border-t bg-white flex justify-end gap-3">
      <button onclick="closeUserModal()" class="px-5 py-2.5 text-sm font-semibold text-slate-600 hover:bg-slate-100 rounded-xl transition">Dismiss</button>
      <button onclick="saveUserDetails()" id="saveUserBtn" class="bg-indigo-600 text-white px-8 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition">Commit Changes</button>
    </div>
  </div>
</div>

<!-- AUTHENTICATION -->
<div id="loginDiv" class="flex items-center justify-center min-h-screen p-6 bg-[#f1f5f9]">
  <div class="w-full max-w-md">
    <div class="text-center mb-10">
      <div class="w-16 h-16 bg-indigo-600 rounded-2xl shadow-xl shadow-indigo-200 mx-auto flex items-center justify-center mb-4">
        <span class="text-3xl">K</span>
      </div>
      <h1 class="text-2xl font-black tracking-tight text-slate-900 uppercase">Kardan Admin</h1>
      <p class="text-slate-500 mt-2">Centralized Operational Management</p>
    </div>
    <div class="bg-white p-10 rounded-3xl shadow-xl border border-white">
      <div class="space-y-6">
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Security ID</label>
          <input id="email" type="email" placeholder="admin@kardan.com" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition text-sm"/>
        </div>
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Access Key</label>
          <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition text-sm"/>
        </div>
        <button onclick="login()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-xl hover:bg-slate-800 active:scale-[0.98] transition-all shadow-xl shadow-slate-200">Authenticate Access</button>
        <p id="loginError" class="text-red-500 text-xs text-center font-semibold mt-4"></p>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="adminDiv" class="hidden min-h-screen flex flex-col">
  <!-- Top Navigation Bar -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="max-w-[1440px] mx-auto px-6 h-20 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-black text-xl">K</div>
        <div>
          <h2 class="text-sm font-bold text-slate-900 leading-tight">Operational HQ</h2>
          <p class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Kardan Enterprise</p>
        </div>
      </div>
      <div class="flex items-center gap-6">
        <div class="h-8 w-[1px] bg-slate-200"></div>
        <button onclick="logout()" class="flex items-center gap-2 group">
          <span class="text-xs font-bold text-slate-500 group-hover:text-red-600 transition">Terminate Session</span>
          <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 group-hover:bg-red-50 group-hover:text-red-600 transition">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
          </div>
        </button>
      </div>
    </div>
  </header>

  <div class="flex flex-1 max-w-[1440px] mx-auto w-full">
    <!-- Sidebar Navigation -->
    <aside class="w-72 border-r border-slate-200 p-6 hidden lg:block bg-white">
      <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Main Command</p>
      <nav class="space-y-1">
        <button onclick="setActiveTab('users')" id="btn-users" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition">
          <span class="text-lg">üë•</span> User Directory
        </button>
        <button onclick="setActiveTab('jobs')" id="btn-jobs" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition">
          <span class="text-lg">üíº</span> Active Positions
        </button>
        <button onclick="setActiveTab('pendingJobs')" id="btn-pendingJobs" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition">
          <span class="text-lg">‚è≥</span> Awaiting Review
        </button>
        <button onclick="setActiveTab('posts')" id="btn-posts" class="nav-link w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-50 transition">
          <span class="text-lg">üí¨</span> Feed Activity
        </button>
      </nav>
    </aside>

    <!-- Content Area -->
    <main class="flex-1 p-8">
      <!-- High-Level Metrics -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div id="card-users" class="glass-card p-6 rounded-2xl shadow-sm transition-all duration-500">
          <div class="flex justify-between items-start mb-4">
            <div class="w-12 h-12 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center text-xl">üë•</div>
            <div id="filter-badge" class="hidden px-2 py-1 bg-indigo-600 text-white text-[9px] font-black uppercase rounded tracking-tighter">Dated Filter</div>
          </div>
          <p id="stat-user-label" class="text-xs font-bold text-slate-400 uppercase tracking-widest">Total Userbase</p>
          <h3 id="stat-totalUsers" class="text-3xl font-black text-slate-900 mt-1">--</h3>
        </div>
        
        <div class="glass-card p-6 rounded-2xl shadow-sm">
          <div class="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center text-xl mb-4">üíº</div>
          <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Verified Vacancies</p>
          <h3 id="stat-totalJobs" class="text-3xl font-black text-slate-900 mt-1">--</h3>
        </div>

        <div class="glass-card p-6 rounded-2xl shadow-sm">
          <div class="w-12 h-12 bg-amber-50 text-amber-600 rounded-xl flex items-center justify-center text-xl mb-4">‚è≥</div>
          <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Pending Verification</p>
          <h3 id="stat-pendingJobs" class="text-3xl font-black text-slate-900 mt-1">--</h3>
        </div>
      </div>

      <!-- Dynamic View Container -->
      <div id="content" class="bg-white rounded-3xl border border-slate-200 shadow-sm p-8 min-h-[500px]">
        <div class="flex flex-col items-center justify-center h-[400px] text-slate-300">
          <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-6">
            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
          </div>
          <p class="font-bold text-slate-400 uppercase tracking-widest text-xs">Initialization Complete</p>
          <p class="text-sm">Select a category from the sidebar to begin management.</p>
        </div>
      </div>
    </main>
  </div>
</div>

<script>
/* ============================
   Core Logic & Firebase
============================ */
const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
  measurementId: "G-RRC3X485KQ"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const ADMIN_UID = "nkXAUBb7ffZQ5CtyShWl6YcQ39t2";

let activeTab = null;
let currentFilter = 'all';

auth.onAuthStateChanged(user => {
  if (user && user.uid === ADMIN_UID) {
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("adminDiv").classList.remove("hidden");
    refreshDashboardStats();
    setActiveTab('users'); // Default view
  } else {
    document.getElementById("loginDiv").classList.remove("hidden");
    document.getElementById("adminDiv").classList.add("hidden");
  }
});

async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const errorDiv = document.getElementById("loginError");
  try {
    const userCred = await auth.signInWithEmailAndPassword(email, password);
    if (userCred.user.uid !== ADMIN_UID) {
      errorDiv.textContent = "ACCESS DENIED: Administrative Privileges Required.";
      await auth.signOut();
    }
  } catch (err) { errorDiv.textContent = err.message.toUpperCase(); }
}

async function logout() { await auth.signOut(); }

/* ============================
   Statistics Management
============================ */
async function refreshDashboardStats(specificUserCount = null, isFiltered = false) {
    try {
        const userCard = document.getElementById("card-users");
        const filterBadge = document.getElementById("filter-badge");
        
        if (!isFiltered) {
            const usersSnap = await db.collection("users").get();
            document.getElementById("stat-totalUsers").innerText = usersSnap.size.toLocaleString();
            document.getElementById("stat-user-label").innerText = "Total Userbase";
            userCard.classList.remove("stats-glow", "filter-active");
            filterBadge.classList.add("hidden");
        } else {
            document.getElementById("stat-totalUsers").innerText = specificUserCount.toLocaleString();
            document.getElementById("stat-user-label").innerText = "Users on Date";
            userCard.classList.add("stats-glow", "filter-active");
            filterBadge.classList.remove("hidden");
        }

        const approvedJobsSnap = await db.collection("jobs").where("status", "==", "approved").get();
        document.getElementById("stat-totalJobs").innerText = approvedJobsSnap.size.toLocaleString();

        const pendingJobsSnap = await db.collection("jobs").where("status", "==", "pending").get();
        document.getElementById("stat-pendingJobs").innerText = pendingJobsSnap.size.toLocaleString();
    } catch (e) { console.error("Stats Error:", e); }
}

/* ============================
   Tab System
============================ */
function setActiveTab(tab) {
    activeTab = tab;
    document.querySelectorAll('.nav-link').forEach(btn => btn.classList.remove('active'));
    document.getElementById(`btn-${tab}`)?.classList.add('active');

    switch(tab) {
        case 'jobs': showJobs(); break;
        case 'pendingJobs': showPendingJobs(); break;
        case 'users': showUsers(); break;
        case 'posts': showPosts(); break;
    }
}

/* ============================
   User Module (Logic Kept Same)
============================ */
async function showUsers() {
    const content = document.getElementById("content");
    content.innerHTML = `
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 border-b pb-6">
        <div>
          <h2 class="text-2xl font-black text-slate-900">User Intelligence</h2>
          <p class="text-sm text-slate-500">Cross-reference and filter the entire platform registry</p>
        </div>
        <div class="flex flex-wrap items-center gap-3">
            <div class="flex items-center gap-2 bg-slate-100 p-1 rounded-xl">
                <button onclick="filterUsers('all')" id="u-all" class="px-4 py-2 text-xs font-bold rounded-lg ${currentFilter==='all'?'bg-white shadow-sm text-indigo-600':'text-slate-500'}">Full Directory</button>
                <button onclick="filterUsers('new')" id="u-new" class="px-4 py-2 text-xs font-bold rounded-lg ${currentFilter==='new'?'bg-white shadow-sm text-indigo-600':'text-slate-500'}">Recently Joined</button>
            </div>
            <div class="flex items-center gap-2">
                <input type="date" id="dateFilter" class="text-xs p-2.5 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 font-bold" onchange="loadUsersData()"/>
                <button onclick="resetUserFilters()" class="text-xs text-indigo-600 font-black uppercase tracking-tighter hover:underline px-2">Clear</button>
            </div>
        </div>
      </div>
      <div id="usersList" class="grid grid-cols-1 gap-4">Loading community matrix...</div>
    `;
    loadUsersData();
}

async function loadUsersData() {
    const list = document.getElementById("usersList");
    const dateLimit = document.getElementById("dateFilter").value;
    list.innerHTML = '<div class="py-20 flex justify-center"><div class="animate-spin w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full"></div></div>';
    
    try {
        const snap = await db.collection("users").get();
        if(snap.empty) { list.innerHTML = `<p class="text-center text-slate-400 py-20 font-bold">Registry Empty</p>`; return; }

        const now = new Date();
        const fifteenDaysAgo = new Date();
        fifteenDaysAgo.setDate(now.getDate() - 15);

        let users = snap.docs.map(d => ({ id: d.id, ...d.data() }));

        if (currentFilter === 'new') {
            users = users.filter(u => {
                const regDate = u.createdAt?.toDate ? u.createdAt.toDate() : (u.timestamp?.toDate ? u.timestamp.toDate() : null);
                return regDate && regDate >= fifteenDaysAgo;
            });
        }

        if (dateLimit) {
            users = users.filter(u => {
                const regDate = u.createdAt?.toDate ? u.createdAt.toDate() : (u.timestamp?.toDate ? u.timestamp.toDate() : null);
                if (!regDate) return false;
                return regDate.toISOString().split('T')[0] === dateLimit;
            });
            refreshDashboardStats(users.length, true);
        } else { refreshDashboardStats(); }

        if(users.length === 0) { list.innerHTML = `<div class="text-center py-20 bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 text-slate-400 font-bold">NO RECORDS FOUND</div>`; return; }

        list.innerHTML = users.map(u => {
            const isThisAdmin = u.id === ADMIN_UID;
            const regDate = u.createdAt?.toDate ? u.createdAt.toDate() : (u.timestamp?.toDate ? u.timestamp.toDate() : null);
            const dateStr = regDate ? regDate.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric' }) : 'N/A';

            return `<div class="p-5 border border-slate-100 rounded-2xl bg-white flex flex-col sm:flex-row justify-between items-center transition-all hover:border-indigo-100 hover:shadow-lg hover:shadow-indigo-50/50 group">
                <div class="flex items-center gap-4 w-full sm:w-auto">
                  <div class="w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center text-slate-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition font-black">
                    ${(u.name || "A").charAt(0)}
                  </div>
                  <div class="truncate">
                    <h4 class="font-bold text-slate-900 truncate">${u.name || "Anonymous User"} ${isThisAdmin ? '<span class="ml-2 px-2 py-0.5 bg-indigo-600 text-[8px] text-white rounded font-black uppercase">System Admin</span>' : ''}</h4>
                    <p class="text-xs text-slate-500 font-medium">${u.email || 'No email attached'}</p>
                    <div class="flex gap-4 mt-2">
                        <span class="text-[9px] text-slate-400 uppercase font-black">Joined ${dateStr}</span>
                        <span class="text-[9px] text-indigo-400 font-mono select-all">UID: ${u.id.substring(0,10)}...</span>
                    </div>
                  </div>
                </div>
                <div class="flex items-center gap-3 mt-4 sm:mt-0 w-full sm:w-auto">
                  <button onclick="openEditUser('${u.id}')" class="w-full sm:w-auto px-6 py-2 bg-slate-900 text-white text-xs font-bold rounded-xl hover:bg-slate-700 transition shadow-sm">Inspect Profile</button>
                </div>
              </div>`;
        }).join("");
    } catch(e) { list.innerHTML = `<p class="text-red-500">System Error: ${e.message}</p>`; }
}

function filterUsers(type) { currentFilter = type; showUsers(); }
function resetUserFilters() { document.getElementById('dateFilter').value = ''; filterUsers('all'); }

/* ============================
   Profile Editing
============================ */
async function openEditUser(userId) {
    const modal = document.getElementById("editUserModal");
    const container = document.getElementById("dynamicFields");
    document.getElementById("editUserId").value = userId;
    container.innerHTML = `<div class="col-span-full py-10 flex justify-center"><div class="animate-spin w-6 h-6 border-2 border-indigo-600 border-t-transparent rounded-full"></div></div>`;
    modal.classList.remove("hidden");

    try {
        const uDoc = await db.collection("users").doc(userId).get();
        const data = uDoc.data() || {};
        container.innerHTML = "";
        
        const mainFields = ['name', 'email', 'phone', 'location', 'role', 'bio'];
        const allKeys = [...new Set([...mainFields, ...Object.keys(data)])].filter(k => !['createdAt','timestamp','uid'].includes(k));

        allKeys.forEach(key => {
            const val = data[key] || "";
            const isLong = typeof val === 'string' && val.length > 60;
            container.insertAdjacentHTML('beforeend', `
              <div class="${isLong ? 'col-span-full' : ''}">
                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">${key}</label>
                ${isLong ? 
                  `<textarea data-key="${key}" class="w-full p-4 bg-white border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none h-32 transition shadow-sm">${val}</textarea>` :
                  `<input type="text" data-key="${key}" value="${val}" class="w-full p-4 bg-white border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition shadow-sm"/>`
                }
              </div>
            `);
        });
    } catch(e) { container.innerHTML = `<p class="text-red-500 font-bold">Data corruption error</p>`; }
}

async function saveUserDetails() {
    const userId = document.getElementById("editUserId").value;
    const saveBtn = document.getElementById("saveUserBtn");
    const inputs = document.querySelectorAll("#dynamicFields [data-key]");
    const updatedData = {};
    inputs.forEach(el => { updatedData[el.dataset.key] = el.value; });

    try {
        saveBtn.disabled = true; saveBtn.innerText = "Synchronizing...";
        await db.collection("users").doc(userId).update(updatedData);
        closeUserModal();
        loadUsersData(); 
    } catch(e) { alert("Sync Failure: " + e.message); } finally { saveBtn.disabled = false; saveBtn.innerText = "Commit Changes"; }
}

function closeUserModal() { document.getElementById("editUserModal").classList.add("hidden"); }

/* ============================
   Helper: User Fetching
============================ */
async function fetchUserName(uid) {
    if(!uid) return "System";
    try {
        const uDoc = await db.collection("users").doc(uid).get();
        return uDoc.exists ? (uDoc.data().name || "Registered User") : "External Entity";
    } catch { return "Unknown"; }
}

/* ============================
   Placeholder Modules (Logic Restored)
============================ */
async function showJobs() {
    const content = document.getElementById("content");
    content.innerHTML = `<div class="flex justify-between items-center mb-8 border-b pb-6"><div><h2 class="text-2xl font-black text-slate-900">Active Positions</h2><p class="text-sm text-slate-500">Verified live listings</p></div><input id="jobSearch" type="text" placeholder="Search matrix..." class="text-xs p-3 border border-slate-200 rounded-xl w-64 bg-slate-50 outline-none focus:ring-2 focus:ring-indigo-500" onkeyup="if(event.key==='Enter') loadJobs()"/></div><div id="jobsList" class="space-y-4"></div>`;
    loadJobs();
}

async function loadJobs() {
    const list = document.getElementById("jobsList");
    const search = document.getElementById("jobSearch")?.value.toLowerCase() || "";
    try {
        const snap = await db.collection("jobs").where("status", "==", "approved").get();
        const html = await Promise.all(snap.docs.map(async doc => {
            const j = doc.data();
            if(search && !j.title?.toLowerCase().includes(search)) return null;
            return `<div class="p-5 border rounded-2xl flex justify-between items-center bg-white hover:bg-slate-50 transition border-slate-100">
                <div class="truncate pr-4"><h4 class="font-bold text-slate-800 truncate">${j.title}</h4><p class="text-xs text-slate-500 font-medium">${j.company} ‚Ä¢ ${j.postedBy || 'Email Restricted'}</p></div>
                <button onclick="deleteJob('${doc.id}')" class="shrink-0 text-red-500 hover:bg-red-50 px-4 py-2 rounded-xl text-xs font-bold transition">Delete Position</button>
              </div>`;
        }));
        list.innerHTML = html.filter(x => x).join("") || `<p class="text-center py-20 text-slate-400 font-bold uppercase tracking-widest text-[10px]">Registry Empty</p>`;
    } catch(e) { console.error(e); }
}

async function showPendingJobs() {
    const content = document.getElementById("content");
    content.innerHTML = `<div class="mb-8 border-b pb-6"><h2 class="text-2xl font-black text-amber-600 uppercase tracking-tighter">Awaiting Review</h2><p class="text-sm text-slate-500">Unverified listings pending administrative clearance</p></div><div id="pendingList" class="space-y-4"></div>`;
    const list = document.getElementById("pendingList");
    try {
        const snap = await db.collection("jobs").where("status", "==", "pending").get();
        if(snap.empty) { list.innerHTML = `<div class="py-20 text-center"><p class="text-slate-300 font-black uppercase text-xs">Clear Workspace</p></div>`; return; }
        const html = await Promise.all(snap.docs.map(async doc => {
            const j = doc.data();
            return `<div class="p-6 bg-amber-50/30 border border-amber-100 rounded-2xl flex justify-between items-center">
                <div class="truncate"><h4 class="font-bold text-slate-900">${j.title}</h4><p class="text-xs text-slate-500 mt-1">${j.company}</p></div>
                <div class="flex gap-2">
                    <button onclick="updateJobStatus('${doc.id}','approved')" class="bg-indigo-600 text-white px-5 py-2 rounded-xl text-xs font-bold shadow-md hover:bg-indigo-700 transition">Authorize</button>
                    <button onclick="deleteJob('${doc.id}')" class="bg-white text-red-500 border border-red-100 px-5 py-2 rounded-xl text-xs font-bold hover:bg-red-50 transition">Reject</button>
                </div>
              </div>`;
        }));
        list.innerHTML = html.join("");
    } catch(e) { console.error(e); }
}

async function updateJobStatus(id, status) {
    try { 
        await db.collection("jobs").doc(id).update({ status: status }); 
        refreshDashboardStats();
        if(activeTab === 'pendingJobs') showPendingJobs(); else loadJobs(); 
    } catch(e) { alert(e.message); }
}

async function deleteJob(id) {
    if(confirm("Confirm deletion of this operational record?")) {
        try { 
            await db.collection("jobs").doc(id).delete(); 
            refreshDashboardStats();
            if(activeTab === 'pendingJobs') showPendingJobs(); else loadJobs(); 
        } catch(e) { alert(e.message); }
    }
}

async function showPosts() {
    const content = document.getElementById("content");
    content.innerHTML = `<div class="flex justify-between items-center mb-8 border-b pb-6"><div><h2 class="text-2xl font-black text-slate-900">Activity Feed</h2><p class="text-sm text-slate-500">Community generated content</p></div></div><div id="postsList" class="space-y-6"></div>`;
    loadPostsData();
}

async function loadPostsData() {
    const list = document.getElementById("postsList");
    try {
        const snap = await db.collection("posts").orderBy("timestamp", "desc").get();
        const html = await Promise.all(snap.docs.map(async doc => {
            const p = doc.data();
            const user = await fetchUserName(p.userId);
            return `<div class="bg-slate-50 border border-slate-100 p-6 rounded-3xl relative group">
                <div class="flex justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-white border rounded-full flex items-center justify-center text-[10px] font-black">${user.charAt(0)}</div>
                        <div><p class="text-xs font-bold text-slate-900">${user}</p><p class="text-[9px] text-slate-400 uppercase font-black">${p.timestamp?.toDate().toLocaleString() || 'Recent'}</p></div>
                    </div>
                    <button onclick="deletePost('${doc.id}')" class="text-slate-300 hover:text-red-500 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                </div>
                <p class="text-sm text-slate-700 leading-relaxed">${p.content || p.text || '...'}</p>
                ${p.imageUrl ? `<img src="${p.imageUrl}" class="mt-4 rounded-2xl w-full object-cover max-h-80 border" onerror="this.style.display='none'">` : ''}
              </div>`;
        }));
        list.innerHTML = html.join("") || `<p class="text-center py-20 text-slate-300">Quiet Feed</p>`;
    } catch(e) { console.error(e); }
}

async function deletePost(id) {
    if(confirm("Terminate community post?")) {
        try { await db.collection("posts").doc(id).delete(); loadPostsData(); } catch(e) { alert(e.message); }
    }
}
</script>
</body>
</html>
