<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jobs - BooterSpace</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .latest-badge {
      animation: flash 1s infinite;
    }
    @keyframes flash {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }
    /* Skeleton Loading */
    @keyframes shimmer {
      0% { background-position: -468px 0; }
      100% { background-position: 468px 0; }
    }
    .skeleton {
      background: #f6f7f8;
      background-image: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
      background-repeat: no-repeat;
      background-size: 800px 104px;
      display: inline-block;
      position: relative;
      animation: shimmer 1.2s infinite linear;
    }
    .suggestions-list::-webkit-scrollbar { width: 6px; }
    .suggestions-list::-webkit-scrollbar-track { background: #f1f1f1; }
    .suggestions-list::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
    .suggestions-list::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col font-sans">

  <!-- ===== NAVBAR ===== -->
  <!-- üî• SaaS Navbar -->

  <div id="navbar"></div>

<script>
fetch("navbar.html")
.then(r=>r.text())
.then(html=>{
  document.getElementById("navbar").innerHTML=html;
  const s=document.createElement("script");
  s.src="navbar.js";
  document.body.appendChild(s);
});
</script>

  <!-- ===== HEADER & SEARCH ===== -->
  <header class="bg-white border-b border-gray-200">
    <div class="max-w-6xl mx-auto pt-10 pb-12 px-4 text-center">
      <h1 class="text-4xl font-extrabold text-gray-900">
        Explore the <span class="text-blue-600">Perfect Career</span>
      </h1>
      <p class="text-lg text-gray-500 mt-2">
        Discover thousands of job opportunities across the globe
      </p>

      <!-- SEARCH BAR -->
      <div class="bg-white p-2 rounded-2xl shadow-xl border border-gray-100 max-w-5xl mx-auto mt-8">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-2">

          <!-- Keyword -->
          <div class="md:col-span-4 relative">
            <input type="text" id="searchInput"
              class="block w-full pl-11 pr-10 py-4 bg-gray-50 rounded-xl focus:ring-2 focus:ring-blue-500 focus:bg-white"
              placeholder="Job title, keywords, or company" autocomplete="off">
            <button id="clearSearchBtn" class="hidden absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
              ‚úï
            </button>
            <div id="suggestionsBox" class="hidden absolute z-50 w-full mt-2 bg-white border border-gray-200 rounded-xl shadow-lg max-h-72 overflow-y-auto suggestions-list"></div>
          </div>

          <!-- Location -->
          <div class="md:col-span-3 relative">
            <input type="text" id="locationInput"
              class="block w-full pl-11 pr-10 py-4 bg-gray-50 rounded-xl focus:ring-2 focus:ring-blue-500 focus:bg-white"
              placeholder="City or Remote" autocomplete="off">
            <button id="clearLocationBtn" class="hidden absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
              ‚úï
            </button>
          </div>

          <!-- Date Filter -->
          <div class="md:col-span-3 relative">
            <select id="dateFilter" class="block w-full pl-4 pr-10 py-4 bg-gray-50 rounded-xl focus:ring-2 focus:ring-blue-500 cursor-pointer">
              <option value="all">Any time posted</option>
              <option value="1">Past 24 hours</option>
              <option value="7">Past week</option>
              <option value="30">Past month</option>
            </select>
          </div>

          <!-- Search Button -->
          <div class="md:col-span-2">
            <button id="mainSearchBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl">
              üîç Find Jobs
            </button>
          </div>

        </div>
      </div>
    </div>
  </header>

  <!-- ===== JOB LIST ===== -->
  <main class="max-w-4xl mx-auto px-4 py-10 flex-grow">
    <div class="flex justify-between items-center mb-8 gap-4 flex-wrap">
      <h2 id="jobCount" class="text-gray-900 font-bold text-xl">Loading jobs...</h2>
      <div class="flex items-center gap-2 text-sm">
        <span class="text-gray-500">Sort by:</span>
        <select class="bg-transparent border-none font-semibold text-blue-600 focus:ring-0 cursor-pointer p-0">
          <option>Newest first</option>
          <option>Oldest first</option>
        </select>
      </div>
    </div>

    <div id="jobsList" class="space-y-6">
      <!-- Skeleton jobs -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
        <div class="flex gap-4">
          <div class="w-16 h-16 rounded-xl skeleton"></div>
          <div class="flex-grow space-y-3">
            <div class="h-6 w-1/3 skeleton rounded"></div>
            <div class="h-4 w-1/2 skeleton rounded"></div>
            <div class="h-4 w-1/4 skeleton rounded"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-12">
      <button id="loadMoreBtn" class="hidden bg-white border border-gray-200 text-gray-700 px-8 py-3 rounded-xl shadow-sm hover:shadow-md hover:border-gray-300 font-bold">
        Load More Jobs
      </button>
    </div>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="bg-white border-t border-gray-200 py-10 mt-12">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
      <div class="flex flex-col items-center md:items-start">
        <div class="font-bold text-xl text-blue-700 mb-2">BooterSpace</div>
        <p class="text-gray-400 text-sm">Connecting talent with destiny.</p>
      </div>
      <div class="flex gap-8 text-sm text-gray-500">
        <a href="#" class="hover:text-blue-600">Privacy Policy</a>
        <a href="#" class="hover:text-blue-600">Terms of Service</a>
        <a href="#" class="hover:text-blue-600">Contact Us</a>
      </div>
      <p class="text-gray-400 text-sm">&copy; 2024 BooterSpace. All rights reserved.</p>
    </div>
  </footer>

  <!-- ===== FIREBASE LOGIC ===== -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
      authDomain: "kar-kardan.firebaseapp.com",
      projectId: "kar-kardan",
      storageBucket: "kar-kardan.firebasestorage.app",
      messagingSenderId: "554147696994",
      appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM
    const jobsList = document.getElementById("jobsList");
    const loadMoreBtn = document.getElementById("loadMoreBtn");
    const searchInput = document.getElementById("searchInput");
    const locationInput = document.getElementById("locationInput"); 
    const dateFilter = document.getElementById("dateFilter");
    const mainSearchBtn = document.getElementById("mainSearchBtn");
    const suggestionsBox = document.getElementById("suggestionsBox");
    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const clearLocationBtn = document.getElementById("clearLocationBtn"); 
    const jobCountLabel = document.getElementById("jobCount");

    let allJobs = [];
    let filteredJobs = [];
    let visibleJobs = [];
    let pageSize = 10;
    let currentIndex = 0;

    async function fetchJobs() {
      const snapshot = await db.collection("jobs").where("status", "==", "approved").orderBy("timestamp", "desc").get();
      allJobs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      filteredJobs = [...allJobs];
      resetPagination();
    }

    function resetPagination() { currentIndex = 0; visibleJobs = []; renderPagination(); }

    function renderPagination() {
      const nextBatch = filteredJobs.slice(currentIndex, currentIndex + pageSize);
      visibleJobs = visibleJobs.concat(nextBatch);
      renderJobs(visibleJobs);
      currentIndex += pageSize;
      loadMoreBtn.classList.toggle("hidden", currentIndex >= filteredJobs.length);
      jobCountLabel.innerHTML = filteredJobs.length === 0 ? "No jobs match your search" : `${filteredJobs.length} results found`;
    }

    loadMoreBtn.addEventListener("click", renderPagination);

    function renderJobs(jobs) {
      if(currentIndex===0) jobsList.innerHTML="";
      jobs.forEach(job=>{
        const date = job.timestamp?.toDate();
        const isLatest = date && (new Date() - date)/(1000*60*60*24)<=7;
        const imgUrl = job.companyImageUrl||`https://ui-avatars.com/api/?name=${encodeURIComponent(job.company)}&background=random`;
        const salaryHtml = job.salary?`<span class="text-blue-600 font-semibold">${job.salary}</span>`:'';
        const typeColors = { 'Full-time':'bg-blue-50 text-blue-700','Part-time':'bg-purple-50 text-purple-700','Contract':'bg-orange-50 text-orange-700','Remote':'bg-green-50 text-green-700'};
        const badgeClass = typeColors[job.type||'Full-time']||'bg-gray-100 text-gray-700';
        const typeLabel = job.type||'Full-time';
        const div = document.createElement("div");
        div.className="group bg-white p-6 rounded-2xl border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col md:flex-row gap-6 relative";
        div.innerHTML=`
          <div class="flex-shrink-0">
            <img src="${imgUrl}" class="w-16 h-16 rounded-xl border border-gray-100 object-cover bg-gray-50 shadow-sm">
          </div>
          <div class="flex-grow">
            <div class="flex flex-wrap items-center gap-2 mb-2">
              <h3 class="font-bold text-xl text-gray-900 group-hover:text-blue-600 transition-colors">${job.title}</h3>
              ${isLatest?`<span class="latest-badge bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-md uppercase">Latest</span>`:""}
            </div>
            <div class="flex flex-wrap items-center gap-y-1 gap-x-4 mb-4 text-sm text-gray-500">
              <span class="font-semibold text-gray-700">${job.company}</span>
              <span>${job.location||'Remote'}</span>
              ${salaryHtml}
            </div>
            <div class="flex gap-2">
              <span class="px-3 py-1 rounded-full text-xs font-bold ${badgeClass}">${typeLabel}</span>
            </div>
          </div>
          <div class="flex md:flex-col justify-end items-end gap-3 mt-4 md:mt-0">
            <button onclick="applyJob('${job.id}')" class="w-full md:w-32 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 rounded-lg text-sm">Apply Now</button>
            <button onclick="viewJob('${job.id}')" class="w-full md:w-32 bg-white border border-gray-200 hover:border-gray-300 text-gray-700 font-bold py-2.5 rounded-lg text-sm">Details</button>
          </div>
        `;
        jobsList.appendChild(div);
      });
    }

    function filterJobs() {
      const textQuery = searchInput.value.toLowerCase().trim();
      const locQuery = locationInput.value.toLowerCase().trim();
      const dateValue = dateFilter.value;
      filteredJobs = allJobs.filter(job=>{
        const title = (job.title||'').toLowerCase();
        const company = (job.company||'').toLowerCase();
        const location = (job.location||'').toLowerCase();
        const matchesText = !textQuery||title.includes(textQuery)||company.includes(textQuery);
        const matchesLocation = !locQuery||location.includes(locQuery);
        let matchesDate = true;
        if(dateValue!=='all'&&job.timestamp){
          const diffDays = (new Date()-job.timestamp.toDate())/(1000*60*60*24);
          matchesDate = diffDays<=parseInt(dateValue);
        }
        return matchesText&&matchesLocation&&matchesDate;
      });
      resetPagination();
    }

    searchInput.addEventListener('input',()=>{ filterJobs(); });
    locationInput.addEventListener('input',()=>{ filterJobs(); });
    dateFilter.addEventListener('change',filterJobs);
    mainSearchBtn.addEventListener('click',filterJobs);

    window.applyJob=id=>window.location.href=`job-detail.html?id=${id}`;
    window.viewJob=id=>window.location.href=`job-detail.html?id=${id}`;

    fetchJobs();
  </script>
</body>
</html>
