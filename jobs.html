<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find Jobs in India | KARDAN Job Portal</title>
  <meta name="description" content="Discover the latest job opportunities in India. Browse verified job listings, apply directly, and build your career with KARDAN.">
  <meta name="keywords" content="jobs in India, job portal, career, job search, apply jobs, remote jobs, full-time jobs">
  <meta name="author" content="KARDAN">

  <!-- Social Meta -->
  <meta property="og:title" content="Find Jobs in India | KARDAN Job Portal">
  <meta property="og:description" content="Browse the latest verified job listings in India and apply directly.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://aizzdemon.github.io/kardan-job-portal/jobs.html">
  <meta property="og:image" content="https://aizzdemon.github.io/kardan-job-portal/assets/kardan-preview.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- Navbar -->
  <nav class="bg-white border-b shadow-sm sticky top-0 z-30">
    <div class="max-w-7xl mx-auto flex flex-wrap items-center gap-3 p-4">
      <a href="index.html" class="flex items-center px-4 py-2 text-sm bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow hover:shadow-md transition">
        <i class="fas fa-home mr-2"></i> Home
      </a>
      <a href="jobs.html" class="flex items-center px-4 py-2 text-sm bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow hover:shadow-md transition">
        <i class="fas fa-briefcase mr-2"></i> Jobs
      </a>
      <a href="books.html" class="flex items-center px-4 py-2 text-sm bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow hover:shadow-md transition">
        <i class="fas fa-book mr-2"></i> Buy Books
      </a>
      <a href="profile.html" class="flex items-center px-4 py-2 text-sm bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow hover:shadow-md transition">
        <i class="fas fa-user mr-2"></i> Profile
      </a>
      <a href="companies.html" class="flex items-center px-4 py-2 text-sm bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow hover:shadow-md transition">
        <i class="fas fa-building mr-2"></i> Companies
      </a>
      <a href="contact.html" class="flex items-center px-4 py-2 text-sm bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-lg shadow hover:shadow-md transition">
        <i class="fas fa-envelope mr-2"></i> Contact
      </a>
    </div>
  </nav>

  <!-- Search Section -->
  <main class="max-w-6xl mx-auto p-6">
    <h1 class="text-2xl md:text-3xl font-bold mb-6 text-gray-800">Latest Jobs in India</h1>

    <div class="flex flex-col md:flex-row gap-3 mb-6">
      <!-- Title/Company Search -->
      <div class="relative flex-1">
        <input type="text" id="filterKeyword" placeholder="Search by title or company"
               class="border rounded-lg px-4 py-2 w-full text-sm focus:ring-2 focus:ring-indigo-500 outline-none" autocomplete="off">
        <div id="keywordSuggestions"
             class="absolute bg-white border rounded-lg w-full mt-1 shadow hidden max-h-48 overflow-y-auto z-20"></div>
      </div>
      <!-- Location Search -->
      <div class="relative flex-1">
        <input type="text" id="filterLocation" placeholder="Location"
               class="border rounded-lg px-4 py-2 w-full text-sm focus:ring-2 focus:ring-indigo-500 outline-none" autocomplete="off">
        <div id="locationSuggestions"
             class="absolute bg-white border rounded-lg w-full mt-1 shadow hidden max-h-48 overflow-y-auto z-20"></div>
      </div>
      <button onclick="loadJobs(true)" class="bg-indigo-600 text-white px-6 py-2 rounded-lg text-sm hover:bg-indigo-700 transition">
        Search
      </button>
    </div>

    <!-- Job List -->
    <div id="jobList" class="space-y-3"></div>

    <!-- Load More -->
    <div id="loadMoreContainer" class="text-center mt-6 hidden">
      <button id="loadMoreBtn" class="bg-gray-100 border px-6 py-2 rounded-lg text-sm hover:bg-gray-200 transition">
        Show More Jobs
      </button>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t mt-10 p-6 text-center text-gray-600 text-sm">
    Â© 2025 KARDAN. All rights reserved.
  </footer>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
      authDomain: "kar-kardan.firebaseapp.com",
      projectId: "kar-kardan",
      storageBucket: "kar-kardan.firebasestorage.app",
      messagingSenderId: "554147696994",
      appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
      measurementId: "G-RRC3X485KQ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <!-- Job Listing Logic with Search + Suggestions -->
  <script>
    const filterKeyword = document.getElementById("filterKeyword");
    const filterLocation = document.getElementById("filterLocation");
    const keywordSuggestions = document.getElementById("keywordSuggestions");
    const locationSuggestions = document.getElementById("locationSuggestions");
    const jobList = document.getElementById("jobList");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    const loadMoreBtn = document.getElementById("loadMoreBtn");

    let lastVisible = null;
    const jobsPerPage = 10;
    let allJobsCache = []; // keep all jobs for filtering

    async function loadJobs(isNewSearch = false) {
      if (isNewSearch) {
        jobList.innerHTML = "<p class='text-gray-500 text-sm'>Searching...</p>";
        lastVisible = null;
        loadMoreContainer.classList.add("hidden");
        allJobsCache = [];
      }

      let query = db.collection("jobs").orderBy("timestamp", "desc").limit(jobsPerPage);
      if (lastVisible && !isNewSearch) {
        query = query.startAfter(lastVisible);
      }

      const snapshot = await query.get();
      if (isNewSearch) jobList.innerHTML = "";

      if (snapshot.empty && isNewSearch) {
        jobList.innerHTML = "<p class='text-gray-500 text-sm'>No jobs found.</p>";
        return;
      }

      lastVisible = snapshot.docs[snapshot.docs.length - 1];

      snapshot.forEach(doc => {
        const job = doc.data();
        allJobsCache.push({ id: doc.id, ...job });
        renderJobCard(doc.id, job);
      });

      if (snapshot.docs.length === jobsPerPage) {
        loadMoreContainer.classList.remove("hidden");
      } else {
        loadMoreContainer.classList.add("hidden");
      }

      updateSuggestions();
    }

    function renderJobCard(id, job) {
      let postedDate = "";
      if (job.timestamp && job.timestamp.toDate) {
        const date = job.timestamp.toDate();
        postedDate = date.toLocaleDateString("en-IN", {
          day: "2-digit",
          month: "short",
          year: "numeric"
        });
      }

      const card = document.createElement("div");
      card.className = "flex items-center justify-between border rounded-lg p-4 bg-white shadow-sm hover:shadow transition";
      card.innerHTML = `
        <div class="flex items-center gap-4">
          <img src="${job.logoUrl || 'assets/default-logo.png'}" alt="${job.company}"
               class="w-12 h-12 rounded object-cover border" />
          <div>
            <h2 class="text-base font-semibold text-indigo-600">${job.title}</h2>
            <p class="text-sm text-gray-700">${job.company || "Unknown Company"}</p>
            <p class="text-xs text-gray-500">${job.location || "Location not specified"}</p>
            ${postedDate ? `<p class="text-xs text-gray-400">Posted on: ${postedDate}</p>` : ""}
          </div>
        </div>
        <a href="job-detail.html?id=${id}"
           class="bg-green-600 text-white text-sm px-3 py-1.5 rounded hover:bg-green-700 transition">
           Apply
        </a>
      `;
      jobList.appendChild(card);
    }

    // Update suggestions for keyword + location
    function updateSuggestions() {
      const keywords = [...new Set(allJobsCache.map(job => job.title).concat(allJobsCache.map(job => job.company)))];
      const locations = [...new Set(allJobsCache.map(job => job.location).filter(Boolean))];

      function showSuggestions(input, suggestions, container) {
        container.innerHTML = "";
        const value = input.value.toLowerCase();
        if (!value) {
          container.classList.add("hidden");
          return;
        }
        const filtered = suggestions.filter(s => s && s.toLowerCase().includes(value)).slice(0, 10);
        if (filtered.length === 0) {
          container.classList.add("hidden");
          return;
        }
        filtered.forEach(item => {
          const div = document.createElement("div");
          div.className = "px-3 py-2 text-sm hover:bg-indigo-50 cursor-pointer";
          div.textContent = item;
          div.onclick = () => {
            input.value = item;
            container.classList.add("hidden");
            loadJobs(true);
          };
          container.appendChild(div);
        });
        container.classList.remove("hidden");
      }

      filterKeyword.addEventListener("input", () => showSuggestions(filterKeyword, keywords, keywordSuggestions));
      filterLocation.addEventListener("input", () => showSuggestions(filterLocation, locations, locationSuggestions));
    }

    loadMoreBtn.addEventListener("click", () => loadJobs());
    loadJobs();
  </script>
</body>
</html>
