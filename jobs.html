<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jobs - KARDAN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- FontAwesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100">

  <!-- Navbar -->
  <nav class="shadow-sm sticky top-0 z-30 bg-white">
    <div class="max-w-7xl mx-auto flex flex-wrap items-center gap-3 p-4">
      <a href="index.html" class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        <i class="fas fa-home mr-2"></i> Home
      </a>
      <a href="jobs.html" class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        <i class="fas fa-briefcase mr-2"></i> Jobs
      </a>
      <a href="books.html" class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        <i class="fas fa-book mr-2"></i> Buy Books
      </a>
      <a href="profile.html" class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        <i class="fas fa-user mr-2"></i> Profile
      </a>
      <a href="companies.html" class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        <i class="fas fa-building mr-2"></i> Companies
      </a>
      <a href="contact.html" class="flex items-center px-4 py-2 text-sm bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        <i class="fas fa-envelope mr-2"></i> Contact
      </a>
    </div>
  </nav>

  <!-- Jobs Section -->
  <main class="max-w-5xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-6 text-gray-800">Latest Job Listings</h1>
    <div id="job-list" class="space-y-4"></div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // ✅ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
      authDomain: "kar-kardan.firebaseapp.com",
      projectId: "kar-kardan",
      storageBucket: "kar-kardan.appspot.com",  // ✅ fixed
      messagingSenderId: "554147696994",
      appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
      measurementId: "G-RRC3X485KQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const jobList = document.getElementById("job-list");

    async function loadJobs() {
      const q = query(collection(db, "jobs"), orderBy("timestamp", "desc"));
      const querySnapshot = await getDocs(q);

      querySnapshot.forEach((doc) => {
        const job = doc.data();
        renderJobCard(doc.id, job);
      });
    }

    function renderJobCard(id, job) {
      let postedDate = "";
      if (job.timestamp && job.timestamp.toDate) {
        postedDate = job.timestamp.toDate().toISOString();
      }

      const card = document.createElement("article");
      card.className = "flex flex-col md:flex-row items-start md:items-center justify-between border rounded-lg p-4 bg-white shadow-sm hover:shadow transition";

      const logoHTML = job.logoUrl 
        ? `<img src="${job.logoUrl}" alt="${job.company || 'Company Logo'}" class="w-14 h-14 rounded object-cover border" />`
        : `<div class="w-14 h-14 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-lg">
             <i class="fas fa-building"></i>
           </div>`;

      card.innerHTML = `
        <div class="flex items-center gap-4 w-full">
          ${logoHTML}
          <div>
            <h2 class="text-base font-semibold text-indigo-600">${job.title}</h2>
            <p class="text-sm text-gray-700">${job.company || "Unknown Company"}</p>
            <p class="text-xs text-gray-500 flex items-center gap-1">
              <i class="fas fa-map-marker-alt text-red-500"></i> ${job.location || "Location not specified"}
            </p>
            <p class="text-xs text-gray-500 flex items-center gap-1">
              <i class="fas fa-money-bill-wave text-green-500"></i> ${job.salary || "Salary not specified"}
            </p>
            ${postedDate ? `<p class="text-xs text-gray-400">Posted on: ${new Date(postedDate).toLocaleDateString("en-IN")}</p>` : ""}
          </div>
        </div>
        <div class="mt-3 md:mt-0">
          <a href="job-detail.html?id=${id}"
             class="bg-green-600 text-white text-sm px-3 py-1.5 rounded hover:bg-green-700 transition">
             Apply
          </a>
        </div>
      `;

      jobList.appendChild(card);

      // ✅ Add schema.org JobPosting JSON-LD
      const schema = {
        "@context": "https://schema.org/",
        "@type": "JobPosting",
        "title": job.title || "Job Opening",
        "description": job.about || "Exciting job opportunity.",  // ✅ fixed field
        "datePosted": postedDate || new Date().toISOString(),
        "employmentType": job.type || "FULL_TIME",
        "hiringOrganization": {
          "@type": "Organization",
          "name": job.company || "Unknown Company",
          "logo": job.logoUrl || "https://aizzdemon.github.io/kardan-job-portal/assets/default-logo.png"
        },
        "jobLocation": {
          "@type": "Place",
          "address": {
            "@type": "PostalAddress",
            "addressLocality": job.location || "India",
            "addressCountry": "IN"
          }
        },
        "baseSalary": {
          "@type": "MonetaryAmount",
          "currency": "INR",
          "value": {
            "@type": "QuantitativeValue",
            "value": job.salary && /\d/.test(job.salary) 
              ? job.salary.replace(/[^0-9]/g, "") 
              : "0",   // ✅ improved
            "unitText": "MONTH"
          }
        },
        "applicantLocationRequirements": {
          "@type": "Country",
          "name": "India"
        },
        "directApply": true
      };

      const script = document.createElement("script");
      script.type = "application/ld+json";
      script.textContent = JSON.stringify(schema, null, 2);
      document.body.appendChild(script);
    }

    loadJobs();
  </script>
</body>
</html>
