<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KARDAN Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase Compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-slate-100 min-h-screen">

<!-- LOGIN -->
<div id="loginDiv" class="min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-xl shadow w-full max-w-md">
    <h1 class="text-3xl font-black text-indigo-600 text-center">KARDAN ADMIN</h1>
    <input id="email" type="email" placeholder="Admin Email" class="w-full mt-4 p-3 border rounded">
    <input id="password" type="password" placeholder="Password" class="w-full mt-3 p-3 border rounded">
    <button onclick="login()" class="w-full mt-4 bg-indigo-600 text-white py-3 rounded font-bold">Login</button>
    <p id="loginError" class="text-red-500 text-sm mt-3 text-center"></p>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminDiv" class="hidden">

<header class="bg-white border-b">
  <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
    <div class="font-black text-indigo-600 text-xl">KARDAN ADMIN</div>
    <button onclick="logout()" class="text-red-600 font-bold">Logout</button>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 py-8">

<!-- NAV -->
<div class="grid grid-cols-2 md:grid-cols-6 gap-2 mb-6">
  <button onclick="setTab('jobs')" class="nav-btn p-3 bg-white border rounded">üíº Jobs</button>
  <button onclick="setTab('pending')" class="nav-btn p-3 bg-white border rounded">‚è≥ Pending</button>
  <button onclick="setTab('users')" class="nav-btn p-3 bg-white border rounded">üë• Users</button>
  <button onclick="setTab('places')" class="nav-btn p-3 bg-white border rounded">üìç Places</button>
  <button onclick="setTab('posts')" class="nav-btn p-3 bg-white border rounded">üìù Community</button>
</div>

<div id="content" class="bg-white p-6 rounded-xl border min-h-[400px]">
  Select a section
</div>

</main>
</div>

<script>
/* ======================
   FIREBASE INIT
====================== */
firebase.initializeApp({
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
});

const auth = firebase.auth();
const db = firebase.firestore();
const ADMIN_UID = "nkXAUBb7ffZQ5CtyShWl6YcQ39t2";

let currentTab = null;

/* ======================
   AUTH
====================== */
function login() {
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(e => loginError.textContent = e.message);
}

function logout() {
  auth.signOut();
  location.reload();
}

auth.onAuthStateChanged(user => {
  if (user && user.uid === ADMIN_UID) {
    loginDiv.classList.add("hidden");
    adminDiv.classList.remove("hidden");
  } else {
    loginDiv.classList.remove("hidden");
    adminDiv.classList.add("hidden");
  }
});

/* ======================
   NAV
====================== */
function setTab(tab) {
  currentTab = tab;
  document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("bg-indigo-100"));
  event.target.classList.add("bg-indigo-100");

  if (tab === "jobs") loadJobs(false);
  if (tab === "pending") loadJobs(true);
  if (tab === "users") loadUsers();
  if (tab === "places") loadPlaces();
  if (tab === "posts") loadPosts();
}

/* ======================
   JOBS
====================== */
async function loadJobs(pendingOnly) {
  content.innerHTML = "Loading jobs...";
  const snap = await db.collection("jobs").get();

  const rows = snap.docs.filter(d => {
    const s = d.data().status;
    return pendingOnly ? s !== "approved" : s === "approved";
  });

  content.innerHTML = rows.map(d => `
    <div class="border p-4 rounded mb-2">
      <b>${d.data().title}</b>
      <p class="text-sm text-gray-500">${d.data().company}</p>
      <p class="text-xs">Status: ${d.data().status}</p>
    </div>
  `).join("") || "No jobs found";
}

/* ======================
   USERS
====================== */
async function loadUsers() {
  content.innerHTML = "Loading users...";
  const snap = await db.collection("users").get();
  content.innerHTML = snap.docs.map(d => `
    <div class="border p-3 rounded mb-2">
      <b>${d.data().name || "User"}</b>
      <p class="text-xs">${d.data().email || ""}</p>
    </div>
  `).join("") || "No users";
}

/* ======================
   PLACES
====================== */
async function loadPlaces() {
  content.innerHTML = "Loading places...";
  const snap = await db.collection("places").get();
  content.innerHTML = snap.docs.map(d => `
    <div class="border p-3 rounded mb-2">
      <b>${d.data().name}</b>
      <p class="text-xs">${d.data().category}</p>
    </div>
  `).join("") || "No places";
}

/* ======================
   COMMUNITY POSTS
====================== */
async function loadPosts() {
  content.innerHTML = `
    <input id="search" placeholder="Search posts..."
      class="mb-4 p-2 border rounded w-full" onkeyup="renderPosts()">
    <div id="postList"></div>
  `;
  renderPosts();
}

async function renderPosts() {
  const filter = document.getElementById("search")?.value.toLowerCase() || "";
  const list = document.getElementById("postList");

  const snap = await db.collection("communityPosts").orderBy("timestamp", "desc").get();

  list.innerHTML = snap.docs.map(d => {
    const p = d.data();
    if (filter && !p.content.toLowerCase().includes(filter)) return "";
    return `
      <div class="border p-4 rounded mb-3">
        <div class="flex justify-between">
          <b>${p.userName || "User"}</b>
          <button class="text-red-600 text-sm" onclick="deletePost('${d.id}')">Delete</button>
        </div>
        <p class="mt-2 text-sm">${p.content}</p>
      </div>
    `;
  }).join("") || "No posts";
}

async function deletePost(id) {
  if (confirm("Delete this post?")) {
    await db.collection("communityPosts").doc(id).delete();
    renderPosts();
  }
}
</script>

</body>
</html>

