<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Post a Job - KARDAN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <style>
    .logo-box {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #ff5733;
      color: white;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 5px;
    }
    .nav-button {
      background-color: #d3d3d3;
      border: 1px solid #bbb;
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 13px;
      font-weight: bold;
      text-decoration: none;
      color: #000;
    }
    .nav-button:hover {
      background-color: #c0c0c0;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- HEADER -->
<header>
  <div class="logo-box">KARDAN</div>

  <h1 class="text-2xl font-bold text-center mt-6">Post a Job</h1>

  <nav class="mt-4 text-center space-x-2">
    <a href="index.html" class="nav-button"><i class="fas fa-home"></i> Home</a>
    <a href="jobs.html" class="nav-button"><i class="fas fa-briefcase"></i> Jobs</a>
    <a href="companies.html" class="nav-button"><i class="fas fa-building"></i> Companies</a>
    <a href="profile.html" class="nav-button"><i class="fas fa-user"></i> Profile</a>
  </nav>
</header>

<!-- FORM -->
<div class="max-w-md mx-auto mt-8 bg-white p-6 rounded shadow">
  <form id="jobForm" class="space-y-4">

    <input id="jobTitle" type="text" placeholder="Job Title" class="w-full px-3 py-2 border rounded" required>

    <input id="companyName" type="text" placeholder="Company Name" class="w-full px-3 py-2 border rounded" required>

    <input id="companyLogo" type="url" placeholder="Company Logo URL (optional)" class="w-full px-3 py-2 border rounded">

    <input id="jobPlace" type="text" placeholder="Location" class="w-full px-3 py-2 border rounded" required>

    <input id="salary" type="text" placeholder="Salary (optional)" class="w-full px-3 py-2 border rounded">

    <input id="jobLink" type="url" placeholder="Application Link" class="w-full px-3 py-2 border rounded" required>

    <textarea id="jobDescription" rows="3" placeholder="Job Description" class="w-full px-3 py-2 border rounded" required></textarea>

    <button type="submit" class="w-full bg-green-600 text-white font-bold py-2 rounded hover:bg-green-700">
      Publish Job
    </button>
  </form>

  <p id="successMessage" class="hidden mt-3 text-green-600 font-semibold">
    ✅ Job successfully posted (Pending Admin Approval)
  </p>
</div>

<!-- SCRIPT -->
<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
    authDomain: "kar-kardan.firebaseapp.com",
    projectId: "kar-kardan",
    storageBucket: "kar-kardan.appspot.com",
    messagingSenderId: "554147696994",
    appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
    } else {
      alert("You must be logged in to post a job.");
      window.location.href = "login.html";
    }
  });

  document.getElementById("jobForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!currentUser) return;

    try {
      await db.collection("jobs").add({
        userId: currentUser.uid,              // ✅ REQUIRED BY RULE
        title: jobTitle.value.trim(),
        company: companyName.value.trim(),
        logoUrl: companyLogo.value.trim() || null,
        location: jobPlace.value.trim(),
        salary: salary.value.trim() || null,
        applyLink: jobLink.value.trim(),
        about: jobDescription.value.trim(),
        postedBy: currentUser.email,
        status: "pending",                    // ✅ REQUIRED BY RULE
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        likes: 0,
        dislikes: 0
      });

      document.getElementById("successMessage").classList.remove("hidden");
      document.getElementById("jobForm").reset();

    } catch (err) {
      console.error(err);
      alert("❌ Failed to post job. Check console.");
    }
  });
</script>

</body>
</html>
