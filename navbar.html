<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BooterSpace Navbar</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    /* Blur background when search active */
    body.search-active > *:not(nav):not(#searchOverlay) {
      filter: blur(6px);
      pointer-events: none;
      user-select: none;
    }
  </style>
</head>

<body class="bg-gray-50">

<!-- ================= NAVBAR ================= -->
<nav class="bg-white shadow-lg sticky top-0 z-50 border-b border-blue-100">
  <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">

    <!-- LOGO -->
    <a href="index.html" class="text-2xl font-extrabold text-blue-700 flex items-center gap-2">
      <i data-lucide="users" class="w-6 h-6"></i>
      BooterSpace
    </a>

    <!-- SEARCH -->
    <div class="relative w-96 hidden md:block">
      <div class="flex rounded-xl shadow-md">
        <input
          id="searchInput"
          placeholder="Search people..."
          class="w-full px-4 py-2 border rounded-l-xl text-sm focus:ring-2 focus:ring-blue-500"
        />
        <button class="px-4 bg-blue-600 text-white rounded-r-xl">
          <i data-lucide="search" class="w-4 h-4"></i>
        </button>
      </div>

      <!-- Dropdown -->
      <div
        id="searchSuggest"
        class="absolute left-0 right-0 bg-white border rounded-xl mt-2 hidden shadow-lg max-h-96 overflow-y-auto z-50"
      ></div>
    </div>

    <!-- LINKS -->
    <div class="hidden md:flex items-center gap-6">
      <a href="jobs.html" class="text-sm font-medium text-gray-700 hover:text-blue-600">Jobs</a>
      <a href="dashboard.html" id="dashboardBtn" class="hidden text-sm">Dashboard</a>
      <a href="profile.html" id="profileBtn" class="hidden text-sm">Profile</a>
      <a href="login.html" id="loginBtn" class="text-sm">Login</a>
      <a href="signup.html" id="signupBtn"
        class="hidden px-4 py-2 bg-blue-600 text-white rounded-xl text-sm">
        Sign Up
      </a>
      <button id="logoutBtn" class="hidden text-sm text-red-500">Logout</button>
    </div>
  </div>
</nav>

<!-- Invisible overlay for click-out -->
<div id="searchOverlay" class="fixed inset-0 hidden z-40"></div>

<!-- ================= SCRIPT ================= -->
<script type="module">
  /* Icons */
  lucide.createIcons();

  /* Firebase */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    orderBy,
    startAt,
    endAt,
    getDocs
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
    authDomain: "kar-kardan.firebaseapp.com",
    projectId: "kar-kardan",
    storageBucket: "kar-kardan.firebasestorage.app",
    messagingSenderId: "554147696994",
    appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* Elements */
  const searchInput = document.getElementById("searchInput");
  const searchSuggest = document.getElementById("searchSuggest");
  const overlay = document.getElementById("searchOverlay");

  /* Activate blur */
  function openSearch() {
    document.body.classList.add("search-active");
    searchSuggest.classList.remove("hidden");
    overlay.classList.remove("hidden");
  }

  function closeSearch() {
    document.body.classList.remove("search-active");
    searchSuggest.classList.add("hidden");
    overlay.classList.add("hidden");
    searchInput.value = "";
  }

  searchInput.addEventListener("focus", openSearch);
  overlay.addEventListener("click", closeSearch);

  /* Firestore Search */
  async function searchPeople(text) {
    searchSuggest.innerHTML = "";
    if (!text) return;

    const q = query(
      collection(db, "users"),
      orderBy("name"),
      startAt(text),
      endAt(text + "\uf8ff")
    );

    const snap = await getDocs(q);

    if (snap.empty) {
      searchSuggest.innerHTML =
        `<p class="p-4 text-gray-500 text-sm">No results found</p>`;
      return;
    }

    snap.forEach(doc => {
      const user = doc.data();

      const div = document.createElement("div");
      div.className =
        "flex items-center gap-3 p-3 hover:bg-blue-50 cursor-pointer";

      div.innerHTML = `
        <img src="${user.photoURL || 'https://via.placeholder.com/40'}"
          class="w-10 h-10 rounded-full object-cover" />
        <div>
          <p class="font-medium">${user.name}</p>
          <p class="text-xs text-gray-500">${user.email || ""}</p>
        </div>
      `;

      div.onclick = () => {
        window.location.href = \`profile.html?uid=\${doc.id}\`;
      };

      searchSuggest.appendChild(div);
    });
  }

  searchInput.addEventListener("input", e => {
    searchPeople(e.target.value.trim());
  });
</script>

</body>
</html>
