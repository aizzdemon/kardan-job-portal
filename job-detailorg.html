<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Job Details – BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

<style>
body { background:#f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; }
.job-card { background:#fff; border-radius:24px; box-shadow: 0 10px 25px -5px rgba(0,0,0,.05); }
.custom-modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  align-items:center;
  justify-content:center;
  z-index:1000;
}
</style>
</head>

<body>

<!-- ================= CONTENT ================= -->
<main class="max-w-4xl mx-auto px-4 py-10">
  <div id="jobDetailsContent" class="job-card p-8">
    Loading...
  </div>
</main>

<!-- ================= ALERT MODAL ================= -->
<div id="alertModal" class="custom-modal">
  <div class="bg-white p-6 rounded-2xl max-w-sm w-full text-center">
    <h3 id="alertTitle" class="text-lg font-bold mb-2"></h3>
    <p id="alertMsg" class="text-gray-600 mb-6"></p>
    <button onclick="closeAlert()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">Close</button>
  </div>
</div>

<!-- ================= LOGIN MODAL ================= -->
<div id="loginModal" class="custom-modal">
  <div class="bg-white p-8 rounded-2xl max-w-sm w-full text-center shadow-xl">
    <div class="w-14 h-14 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
      <i class="fa-solid fa-lock"></i>
    </div>
    <h3 class="text-xl font-black mb-2">Login Required</h3>
    <p class="text-gray-600 mb-6">
      Please login to apply. You’ll be redirected back to this job.
    </p>
    <div class="flex gap-3">
      <button onclick="redirectToLogin()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold">
        Login
      </button>
      <button onclick="closeLoginPopup()" class="flex-1 bg-gray-100 py-3 rounded-xl font-bold">
        Cancel
      </button>
    </div>
  </div>
</div>

<script>
/* ---------- FIREBASE ---------- */
firebase.initializeApp({
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan"
});

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let currentJobId = null;

auth.onAuthStateChanged(u => currentUser = u);

/* ---------- HELPERS ---------- */
function getJobId() {
  return new URLSearchParams(window.location.search).get("id");
}

function showAlert(t,m){
  alertTitle.innerText=t;
  alertMsg.innerText=m;
  alertModal.style.display="flex";
}
function closeAlert(){ alertModal.style.display="none"; }

function showLoginPopup(){ loginModal.style.display="flex"; }
function closeLoginPopup(){ loginModal.style.display="none"; }

function redirectToLogin(){
  localStorage.setItem("redirectAfterLogin", window.location.href);
  window.location.href = "login.html";
}

/* ---------- LOAD JOB ---------- */
window.onload = async () => {
  currentJobId = getJobId();
  if (!currentJobId) return;

  const snap = await db.collection("jobs").doc(currentJobId).get();
  if (!snap.exists) return;

  const job = snap.data();
  renderJob(job);
};

/* ---------- RENDER ---------- */
function renderJob(job){
  jobDetailsContent.innerHTML = `
    <h1 class="text-3xl font-black mb-2">${job.title}</h1>
    <p class="text-blue-600 font-bold mb-4">${job.company}</p>

    <div class="mb-6 text-gray-600 whitespace-pre-line">
      ${job.about}
    </div>

    <button onclick="applyJob('${job.applyLink}')"
      class="bg-blue-600 text-white px-8 py-4 rounded-2xl font-black">
      Apply Now
    </button>
  `;
}

/* ---------- APPLY ---------- */
function applyJob(link){
  if(!currentUser){
    showLoginPopup();
    return;
  }
  window.open(link,"_blank");
}
</script>

</body>
</html>
