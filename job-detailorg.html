<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job Details - BooterSpace</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
body { background:#f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; }
.job-card { background:#fff; border-radius:24px; }
.gradient-border::after {
    content:'';
    position:absolute; top:0; left:0; right:0;
    height:6px;
    background:linear-gradient(90deg,#ef4444,#f87171);
    border-radius:24px 24px 0 0;
}
.shimmer {
    background: linear-gradient(90deg,#f1f5f9 25%,#e2e8f0 50%,#f1f5f9 75%);
    background-size:200% 100%;
    animation: shimmer 1.5s infinite;
}
@keyframes shimmer { 0%{background-position:200% 0}100%{background-position:-200% 0} }
</style>
</head>

<body class="min-h-screen">

<!-- Navbar -->
<div id="navbar"></div>

<main class="max-w-4xl mx-auto px-4 py-10">
<div id="jobDetailsContent" class="job-card gradient-border p-6 md:p-10 relative">

<!-- Skeleton -->
<div class="space-y-6">
<div class="h-48 shimmer rounded-2xl"></div>
<div class="h-10 w-3/4 shimmer rounded"></div>
</div>

</div>
</main>

<script>
/* ---------- NAVBAR LOAD ---------- */
fetch('navbar.html')
.then(r=>r.text())
.then(d=>document.getElementById('navbar').innerHTML=d);

/* ---------- FIREBASE ---------- */
const firebaseConfig = {
apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
authDomain: "kar-kardan.firebaseapp.com",
projectId: "kar-kardan",
storageBucket: "kar-kardan.firebasestorage.app",
messagingSenderId: "554147696994",
appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

if (!firebase.apps.length) {
firebase.initializeApp(firebaseConfig);
}

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let currentJobId = null;

auth.onAuthStateChanged(u => currentUser = u);

/* ---------- JOB LOAD ---------- */
window.addEventListener('DOMContentLoaded', loadJobDetails);

function getJobId() {
return new URLSearchParams(window.location.search).get('id');
}

async function loadJobDetails() {
currentJobId = getJobId();
if (!currentJobId) return renderError("Invalid Job");

const doc = await db.collection('jobs').doc(currentJobId).get();
if (!doc.exists) return renderError("Job not found");

renderJob(doc.data());
}

/* ---------- RENDER JOB ---------- */
function renderJob(job) {
document.getElementById('jobDetailsContent').innerHTML = `
<h1 class="text-3xl font-extrabold mb-4">${job.title}</h1>
<p class="text-lg text-slate-600 mb-6">${job.companyName} â€¢ ${job.location || 'Remote'}</p>

<p class="text-slate-600 mb-8 whitespace-pre-line">${job.details || ''}</p>

<div class="flex gap-4 flex-wrap">
<button onclick="handleApply('${job.applyLink}')"
class="bg-red-600 text-white px-6 py-3 rounded-xl font-bold">
Apply Now
</button>

<button onclick="toggleSaveJob()"
id="saveBtn"
class="border px-6 py-3 rounded-xl font-bold">
<i class="fa-regular fa-bookmark"></i> Save
</button>

<button onclick="shareJob()"
class="border px-6 py-3 rounded-xl font-bold">
<i class="fas fa-share-nodes"></i> Share
</button>
</div>
`;

checkSaved();
}

/* ---------- APPLY LOGIN CHECK ---------- */
function handleApply(link) {
if (!currentUser) {
alert("Please login to apply");
location.href = "login.html";
return;
}
window.open(link, "_blank");
}

/* ---------- SAVE JOB ---------- */
async function toggleSaveJob() {
if (!currentUser) {
alert("Login required to save job");
location.href = "login.html";
return;
}

const ref = db.collection('users')
.doc(currentUser.uid)
.collection('savedJobs')
.doc(currentJobId);

const snap = await ref.get();

if (snap.exists) {
await ref.delete();
document.getElementById('saveBtn').innerHTML =
`<i class="fa-regular fa-bookmark"></i> Save`;
} else {
await ref.set({
jobId: currentJobId,
savedAt: firebase.firestore.FieldValue.serverTimestamp()
});
document.getElementById('saveBtn').innerHTML =
`<i class="fa-solid fa-bookmark"></i> Saved`;
}
}

async function checkSaved() {
if (!currentUser) return;
const ref = db.collection('users')
.doc(currentUser.uid)
.collection('savedJobs')
.doc(currentJobId);

if ((await ref.get()).exists) {
document.getElementById('saveBtn').innerHTML =
`<i class="fa-solid fa-bookmark"></i> Saved`;
}
}

/* ---------- SHARE ---------- */
function shareJob() {
navigator.clipboard.writeText(window.location.href);
alert("Job link copied to clipboard");
}

/* ---------- ERROR ---------- */
function renderError(msg) {
document.getElementById('jobDetailsContent').innerHTML =
`<p class="text-center text-red-500 font-bold">${msg}</p>`;
}
</script>
</body>
</html>
