<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Job Details ‚Äì BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

<style>
body { background:#f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; }
.job-card { background:#fff; border-radius:24px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
.gradient-border::after {
  content:''; position:absolute; top:0; left:0; right:0;
  height:6px; background:linear-gradient(90deg,#2563eb,#60a5fa);
  border-radius:24px 24px 0 0;
}
.shimmer {
  background: linear-gradient(90deg,#f1f5f9 25%,#e2e8f0 50%,#f1f5f9 75%);
  background-size:200% 100%; animation: shimmer 1.5s infinite;
}
@keyframes shimmer {
  0% { background-position:200% 0 } 100% { background-position:-200% 0 }
}
.slide { max-height:0; overflow:hidden; transition:max-height 0.4s ease; }
.slide.open { max-height:400px; }
.custom-modal {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000;
}
</style>
</head>

<body class="min-h-screen bg-gray-50">

<!-- ================= NAVBAR ================= -->
<div id="navbar"></div>
<script>
fetch("navbar.html").then(r=>r.text()).then(html=>{
  document.getElementById("navbar").innerHTML = html;
  const s = document.createElement("script");
  s.type="module"; s.src = "navbar.js";
  document.body.appendChild(s);
});
</script>

<!-- ================= HEADER ================= -->
<header class="bg-white border-b border-gray-200 py-10">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <h1 class="text-3xl font-black tracking-tight text-gray-900 sm:text-4xl">
      Booter<span class="text-blue-600">Space</span>
    </h1>
    <p class="mt-2 text-sm text-gray-500 max-w-md mx-auto">
      Explore your career opportunities and community posts
    </p>
  </div>
</header>

<!-- ================= MAIN ================= -->
<main class="max-w-7xl mx-auto px-4 py-10 grid grid-cols-1 lg:grid-cols-3 gap-8">

  <!-- LEFT: JOB DETAILS -->
  <div class="lg:col-span-2">
    <div id="jobDetailsContent" class="job-card gradient-border p-6 md:p-10 relative">
      <!-- Skeleton Loader -->
      <div class="space-y-6">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 shimmer rounded-xl"></div>
          <div class="flex-1">
            <div class="h-8 w-1/2 shimmer rounded mb-2"></div>
            <div class="h-4 w-1/4 shimmer rounded"></div>
          </div>
        </div>
        <div class="h-48 shimmer rounded-2xl"></div>
        <div class="h-12 w-48 shimmer rounded-xl"></div>
      </div>
    </div>
  </div>

  <!-- RIGHT: FEEDBACK / MISSION CARD -->
  <div>
    <div class="bg-white rounded-2xl shadow-md p-6 sticky top-24">

      <h3 class="text-lg font-bold mb-3">
        üíô Our Mission for <span class="text-gray-900">Job</span><span class="text-blue-600">Seeker</span>
      </h3>

      <p class="text-sm text-gray-600 leading-relaxed mb-4 whitespace-pre-line">
üöÄ We are building this platform with one clear mission ‚Äî to help job seekers find the right job, without any cost.

üîç This project is created with dedication, research, and continuous effort. We carefully research and list job opportunities so job seekers can apply from one place.

üíØ Our platform is 100% free, easy to use, reliable, and constantly improving.

We built this website with Love ‚ù§Ô∏è and hard work. In return, all we ask is your love ‚ù§Ô∏è and support ü§ù. Please share your valuable feedback and suggestions!
      </p>

      <button onclick="toggleFeedback()" 
        class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 mb-2">
        üí¨ Give Feedback
      </button>

      <!-- FEEDBACK FORM -->
      <div id="feedbackBox" class="slide mt-4">
        <input id="feedbackEmail" type="email"
          placeholder="Your email address"
          class="w-full border rounded-lg p-3 mb-1">
        <p id="emailError" class="hidden text-sm text-red-600 mb-2">
          Please enter email
        </p>
        <textarea id="feedbackText" rows="3"
          placeholder="Write your feedback..."
          class="w-full border rounded-lg p-3 mb-3"></textarea>
        <button onclick="submitFeedback()"
          class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-black">
          Submit
        </button>
      </div>

    </div>
  </div>
</main>

<!-- ================= ALERT MODAL ================= -->
<div id="alertModal" class="custom-modal">
  <div class="bg-white p-6 rounded-2xl max-w-sm w-full mx-4 shadow-xl">
    <h3 id="alertTitle" class="text-lg font-bold mb-2">Notice</h3>
    <p id="alertMsg" class="text-gray-600 mb-6"></p>
    <button onclick="closeAlert()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">Close</button>
  </div>
</div>

<script>
/* ---------- FIREBASE INIT ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
  authDomain: "kar-kardan.firebaseapp.com",
  projectId: "kar-kardan",
  storageBucket: "kar-kardan.firebasestorage.app",
  messagingSenderId: "554147696994",
  appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let currentJobId = null;

auth.onAuthStateChanged(u => {
  currentUser = u;
  if (currentJobId) checkSaved();
});

/* ---------- HELPERS ---------- */
function getJobId() { return new URLSearchParams(window.location.search).get("id"); }
function isAdmin() { return currentUser && currentUser.uid === "nkXAUBb7ffZQ5CtyShWl6YcQ39t2"; }
function showAlert(title, msg) {
  document.getElementById('alertTitle').innerText = title;
  document.getElementById('alertMsg').innerText = msg;
  document.getElementById('alertModal').style.display = 'flex';
}
function closeAlert() { document.getElementById('alertModal').style.display = 'none'; }

/* ---------- LOAD JOB ---------- */
window.addEventListener("DOMContentLoaded", async () => {
  currentJobId = getJobId();
  if (!currentJobId) return renderError("Invalid Job ID");

  try {
    const snap = await db.collection("jobs").doc(currentJobId).get();
    if (!snap.exists) return renderError("Job not found");
    const job = snap.data();

    if (job.status !== "approved" && !isAdmin()) return renderError("This job is not approved yet");

    renderJob(job);
    checkSaved();
  } catch (e) {
    console.error(e);
    renderError(e.code === "permission-denied" ? "You are not allowed to view this job" : "Something went wrong");
  }
});

/* ---------- RENDER JOB ---------- */
function renderJob(job) {
  const logoUrl = job.companyImageUrl || job.logoUrl || 'https://via.placeholder.com/100?text=Logo';
  const postedDate = job.timestamp ? new Date(job.timestamp.seconds * 1000).toLocaleDateString() : 'Recently';
  document.getElementById("jobDetailsContent").innerHTML = `
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
      <div class="flex items-start md:items-center gap-5">
        <img src="${logoUrl}" 
             alt="${job.company}" 
             class="w-20 h-20 rounded-2xl object-cover border border-gray-100 shadow-sm"
             onerror="this.src='https://via.placeholder.com/100?text=Company'">
        <div>
          <h1 class="text-3xl font-black text-gray-900 leading-tight">${job.title}</h1>
          <p class="text-lg font-medium text-blue-600 mt-1">${job.company || "Trinity Life Sciences"}</p>
        </div>
      </div>
      <div class="flex flex-col items-start md:items-end gap-1">
        <span class="px-3 py-1 bg-green-50 text-green-700 text-xs font-bold rounded-full uppercase tracking-wider">
          ${job.status || 'Active'}
        </span>
        <p class="text-sm text-gray-400 mt-1"><i class="fa-regular fa-clock mr-1"></i> Posted ${postedDate}</p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
      <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-2xl">
        <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-blue-600 shadow-sm">
          <i class="fa-solid fa-location-dot"></i>
        </div>
        <div>
          <p class="text-xs text-gray-400 font-bold uppercase">Location</p>
          <p class="text-gray-700 font-semibold">${job.location || "Gurgaon, India"}</p>
        </div>
      </div>
      <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-2xl">
        <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-blue-600 shadow-sm">
          <i class="fa-solid fa-wallet"></i>
        </div>
        <div>
          <p class="text-xs text-gray-400 font-bold uppercase">Salary</p>
          <p class="text-gray-700 font-semibold">${job.salary || "Competitive"}</p>
        </div>
      </div>
    </div>

    <div class="prose max-w-none mb-10">
      <h3 class="text-xl font-bold text-gray-900 mb-4">Job Description</h3>
      <div class="text-gray-600 leading-relaxed whitespace-pre-line text-base">
        ${job.about || job.details || "No detailed description provided for this position."}
      </div>
    </div>

    <div class="flex gap-4 flex-wrap border-t border-gray-100 pt-8">
      <button onclick="applyJob('${job.applyLink || ""}')"
        class="flex-1 min-w-[200px] bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-2xl font-black transition-all transform active:scale-95 shadow-lg shadow-blue-200">
        Apply Now <i class="fa-solid fa-arrow-up-right-from-square ml-2 opacity-70"></i>
      </button>

      <button id="saveBtn" onclick="toggleSaveJob()"
        class="px-8 py-4 bg-white border-2 border-gray-100 hover:border-blue-100 rounded-2xl font-bold transition-all text-gray-700">
        <i class="fa-regular fa-bookmark mr-2"></i> Save
      </button>

      <button onclick="shareJob()"
        class="w-14 h-14 md:w-auto md:px-6 bg-gray-50 hover:bg-gray-100 rounded-2xl font-bold transition-all text-gray-700 flex items-center justify-center">
        <i class="fa-solid fa-share-nodes md:mr-2"></i> <span class="hidden md:inline">Share</span>
      </button>
    </div>
  `;
}

/* ---------- APPLY / SAVE / SHARE ---------- */
function applyJob(link) {
  if (!currentUser) return showAlert("Login Required", "Please login to apply for this position.");
  if (!link) return showAlert("Error", "Application link not available.");
  window.open(link, "_blank");
}

async function toggleSaveJob() {
  if (!currentUser) return showAlert("Login Required", "Login to save your favorite jobs.");
  const saveBtn = document.getElementById('saveBtn');
  const ref = db.collection("users").doc(currentUser.uid).collection("savedJobs").doc(currentJobId);
  try {
    const snap = await ref.get();
    if (snap.exists) {
      await ref.delete();
      saveBtn.innerHTML = `<i class="fa-regular fa-bookmark mr-2"></i> Save`;
      saveBtn.classList.remove('text-blue-600','border-blue-100');
    } else {
      await ref.set({ jobId: currentJobId, savedAt: firebase.firestore.FieldValue.serverTimestamp() });
      saveBtn.innerHTML = `<i class="fa-solid fa-bookmark mr-2 text-blue-600"></i> Saved`;
      saveBtn.classList.add('text-blue-600','border-blue-100');
    }
  } catch(e){ console.error(e); }
}

async function checkSaved() {
  if (!currentUser) return;
  const saveBtn = document.getElementById('saveBtn');
  if (!saveBtn) return;
  const ref = db.collection("users").doc(currentUser.uid).collection("savedJobs").doc(currentJobId);
  if ((await ref.get()).exists) {
    saveBtn.innerHTML = `<i class="fa-solid fa-bookmark mr-2 text-blue-600"></i> Saved`;
    saveBtn.classList.add('text-blue-600','border-blue-100');
  }
}

function shareJob() {
  const dummy = document.createElement('input'), text = window.location.href;
  document.body.appendChild(dummy); dummy.value = text; dummy.select(); document.execCommand('copy'); document.body.removeChild(dummy);
  showAlert("Link Copied", "Job details link copied to your clipboard!");
}

/* ---------- FEEDBACK FORM ---------- */
function toggleFeedback() { document.getElementById("feedbackBox").classList.toggle("open"); }

async function submitFeedback() {
  const email = document.getElementById("feedbackEmail").value.trim();
  const text = document.getElementById("feedbackText").value.trim();
  const emailError = document.getElementById("emailError");
  emailError.classList.add("hidden");
  if (!email) { emailError.classList.remove("hidden"); return; }
  if (!text) return;
  try {
    await db.collection("feedbacks").add({
      email, message: text, jobId: currentJobId || null,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById("feedbackEmail").value="";
    document.getElementById("feedbackText").value="";
    toggleFeedback();
    showAlert("Thank You ‚ù§Ô∏è", "Your feedback has been submitted. We appreciate your support!");
  } catch(e){ console.error(e); showAlert("Error","Unable to submit feedback. Try again later."); }
}

/* ---------- ERROR ---------- */
function renderError(msg) {
  document.getElementById("jobDetailsContent").innerHTML = `
    <div class="text-center py-10">
      <div class="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
        <i class="fa-solid fa-circle-exclamation"></i>
      </div>
      <p class="text-red-600 font-bold text-lg">${msg}</p>
      <a href="index.html" class="inline-block mt-4 text-blue-600 font-bold hover:underline">Back to Job Feed</a>
    </div>
  `;
}
</script>
</body>
</html>
