<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Job Details - BooterSpace</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">

	<!-- Navbar Container -->
	<div id="navbarContainer"></div>

	<!-- Job Details Container -->
	<div class="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl p-8 mt-8 mb-12 border-t-4 border-red-600">
		<div id="jobDetailsContent">
			<p class="text-gray-500 text-center py-12 text-lg font-medium">Loading job details...</p>
		</div>
	</div>

	<script>
		// ----------------------------
		// Load Navbar from navbar.html
		// ----------------------------
		fetch('navbar.html')
			.then(response => response.text())
			.then(data => {
				document.getElementById('navbarContainer').innerHTML = data;

				// Reattach logout event after loading navbar
				const logoutBtn = document.getElementById('logoutBtn');
				if(logoutBtn) {
					logoutBtn.onclick = () => {
						auth.signOut().then(() => {
							location.href='login.html';
						}).catch(error => {
							console.error("Logout Error:", error);
						});
					}
				}
			})
			.catch(err => console.error("Navbar load error:", err));

		// ----------------------------
		// Firebase config
		// ----------------------------
		const firebaseConfig = {
			apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
			authDomain: "kar-kardan.firebaseapp.com",
			projectId: "kar-kardan",
			storageBucket: "kar-kardan.firebasestorage.app",
			messagingSenderId: "554147696994",
			appId: "1:554147696994:web:221dcb883e3b65dcea5c3b",
			measurementId: "G-RRC3X485KQ"
		};
		firebase.initializeApp(firebaseConfig);
		const auth = firebase.auth();
		const db = firebase.firestore();

		// ----------------------------
		// Get jobId from URL
		// ----------------------------
		function getJobId() {
			const params = new URLSearchParams(window.location.search);
			return params.get('id');
		}

		auth.onAuthStateChanged(user => {
			if(!user) location.href='login.html';
			loadJobDetails();
		});

		// ----------------------------
		// Load Job Details
		// ----------------------------
		async function loadJobDetails() {
			const jobId = getJobId();
			const container = document.getElementById('jobDetailsContent');

			if(!jobId) {
				container.innerHTML = "<p class='text-red-500 text-center py-8'>‚ùå Invalid job ID. Please check the URL.</p>";
				return;
			}

            try {
                const doc = await db.collection('jobs').doc(jobId).get();
                if(!doc.exists) {
                    container.innerHTML = "<p class='text-red-500 text-center py-8'>‚ùå Job not found. It may have been deleted.</p>";
                    return;
                }

                const job = doc.data();
                const companyLogoUrl = job.companyImageUrl || '';
                const jobPhotoUrl = job.jobImageUrl || '';
                
                let postedByName = 'Unknown Recruiter';
                if(job.postedBy) {
                    const userDoc = await db.collection('users').doc(job.postedBy).get();
                    if(userDoc.exists && userDoc.data().fullName) {
                        postedByName = userDoc.data().fullName;
                    }
                }
                
                const jobDetailsHtml = job.details ? job.details.replace(/\n/g, '<br>') : 'No detailed description provided.';
                const datePosted = job.timestamp ? job.timestamp.toDate().toLocaleDateString() : 'Date N/A';

                container.innerHTML = `
                    ${jobPhotoUrl ? 
                        `<img src="${jobPhotoUrl}" 
                            alt="Job Header Image" 
                            class="w-full h-48 object-cover rounded-xl mb-6 shadow-lg"
                            onerror="this.onerror=null; this.src='https://placehold.co/800x200/E5E7EB/6B7280?text=Job+Header+Image+Unavailable'; this.classList.remove('h-48'); this.classList.add('h-24', 'p-4');"
                        >` 
                        : ''}

                    <h2 class="text-4xl font-extrabold text-gray-900 mb-2">${job.title}</h2>
                    
                    <div class="flex items-center gap-4 border-b pb-4 mb-4">
                        ${companyLogoUrl ? 
                            `<img src="${companyLogoUrl}" 
                                alt="${job.companyName} Logo" 
                                class="w-16 h-16 object-contain rounded-xl border p-1 bg-white"
                                onerror="this.onerror=null; this.src='https://placehold.co/64x64/E5E7EB/6B7280?text=Logo'; this.classList.remove('object-contain'); this.classList.add('object-cover');"
                            >` 
                            : '<div class="w-16 h-16 flex items-center justify-center bg-gray-200 rounded-xl font-bold text-gray-600">üè¢</div>'}
                        
                        <div>
                            <p class="font-bold text-xl text-gray-800">@ ${job.companyName}</p>
                            <p class="text-sm text-red-600 font-semibold">${job.employmentType || 'N/A'}</p>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-4 py-1.5 rounded-full shadow-sm">
                            üìç ${job.location || 'Remote'}
                        </span>
                        <span class="bg-green-100 text-green-800 text-sm font-medium px-4 py-1.5 rounded-full shadow-sm">
                            üí∞ ${job.salary || 'Competitive'}
                        </span>
                        <span class="bg-gray-100 text-gray-600 text-sm font-medium px-4 py-1.5 rounded-full shadow-sm">
                            üìÖ Posted: ${datePosted}
                        </span>
                    </div>

                    <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-900 border-b pb-1">Job Description:</h3>
                    <p class="text-gray-700 leading-relaxed">${jobDetailsHtml}</p>

                    <h3 class="text-2xl font-bold mt-8 mb-3 text-gray-900 border-b pb-1">How to Apply:</h3>
                    <p class="text-gray-600 mb-4">This job was posted by ${postedByName}.</p>
                    
                    <a href="${job.applyLink}" 
                        target="_blank" 
                        class="w-full sm:w-auto mt-4 inline-block text-center bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-xl transition duration-300 shadow-xl transform hover:scale-[1.01]">
                        üöÄ Apply Now via External Link
                    </a>
                `;

            } catch (error) {
                console.error("Error loading job details:", error);
                container.innerHTML = "<p class='text-red-500 text-center py-8'>An error occurred while fetching job details.</p>";
            }
		}
	</script>
</body>
</html>
