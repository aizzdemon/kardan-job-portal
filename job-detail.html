<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Job Details â€“ BooterSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase v10 -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
    authDomain: "kar-kardan.firebaseapp.com",
    projectId: "kar-kardan",
    storageBucket: "kar-kardan.firebasestorage.app",
    messagingSenderId: "554147696994",
    appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let currentUser = null;

  onAuthStateChanged(auth, (user) => {
    currentUser = user;
  });

  async function loadJob() {
    const params = new URLSearchParams(window.location.search);
    const jobId = params.get("id");

    if (!jobId) {
      document.getElementById("jobContainer").innerHTML =
        "<p class='text-red-500'>Invalid Job ID</p>";
      return;
    }

    try {
      const jobRef = doc(db, "jobs", jobId);
      const jobSnap = await getDoc(jobRef);

      if (!jobSnap.exists()) {
        document.getElementById("jobContainer").innerHTML =
          "<p class='text-red-500'>Job not found</p>";
        return;
      }

      const job = jobSnap.data();

      // Update fields
      document.getElementById("jobTitle").textContent = job.title || "N/A";
      document.getElementById("company").textContent = job.company || "N/A";
      document.getElementById("location").textContent = job.location || "N/A";
      document.getElementById("salary").textContent = job.salary || "Not disclosed";

      // FIXED: Use 'about' field and innerHTML for rich content
      document.getElementById("description").innerHTML = job.about || "No description provided";

      document.getElementById("applyBtn").onclick = () => {
        if (!currentUser) {
          alert("Please login or signup to apply for this job.");
          window.location.href = "login.html";
        } else {
          window.open(job.applyLink, "_blank");
        }
      };

      // After job details load, load ads
      loadAds();

    } catch (error) {
      console.error(error);
      document.getElementById("jobContainer").innerHTML =
        "<p class='text-red-500'>Failed to load job</p>";
    }
  }

  // ===================== LOAD ADS =====================
  function loadAds() {
    const script = document.createElement("script");
    script.id = "aclib";
    script.type = "text/javascript";
    script.src = "//acscdn.com/script/aclib.js";
    script.onload = () => {
      aclib.runAutoTag({
        zoneId: 'bp9eaek95x',
      });
    };
    document.head.appendChild(script);
  }

  window.addEventListener("DOMContentLoaded", loadJob);
</script>

<style>
body { background:#f8fafc; }
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="bg-white border-b shadow-sm px-6 py-3 flex justify-between items-center">
  <a href="index.html" class="text-xl font-bold text-blue-600">BooterSpace</a>
  <div class="space-x-4">
    <a href="index.html" class="text-gray-600 hover:text-blue-600">Home</a>
    <a href="login.html" class="text-gray-600 hover:text-blue-600">Login</a>
    <a href="signup.html"
       class="bg-blue-600 text-white px-4 py-1.5 rounded-md hover:bg-blue-700">
      Signup
    </a>
  </div>
</nav>

<!-- JOB DETAILS -->
<main id="jobContainer"
      class="max-w-3xl mx-auto mt-10 bg-white p-6 rounded-xl shadow">

  <h1 id="jobTitle" class="text-2xl font-bold text-gray-800 mb-2">
    Loading...
  </h1>

  <p class="text-gray-600"><strong>Company:</strong> <span id="company"></span></p>
  <p class="text-gray-600"><strong>Location:</strong> <span id="location"></span></p>
  <p class="text-gray-600 mb-4"><strong>Salary:</strong> <span id="salary"></span></p>

  <hr class="my-4" />

  <h2 class="text-lg font-semibold mb-2">Job Description</h2>
  <div id="description" class="text-gray-700 whitespace-pre-line"></div>

  <button id="applyBtn"
    class="mt-6 w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700">
    Apply Now
  </button>

  <!-- Ad placeholder -->
  <div id="adContainer" class="mt-6">
    <!-- Ads will load here via Adcash -->
  </div>

</main>

</body>
</html>
