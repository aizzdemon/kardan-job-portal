<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search People - BooterSpace</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-50">

<!-- NAVBAR -->
<div id="navbar"></div>

<!-- SEARCH PAGE -->
<div class="max-w-3xl mx-auto mt-10 p-4">

  <div class="bg-white shadow-lg rounded-xl p-4">
    <input
      id="searchBox"
      placeholder="Search people by name..."
      class="w-full px-4 py-3 border rounded-xl text-lg focus:ring-2 focus:ring-blue-500"
      autofocus
    />

    <div
      id="results"
      class="mt-4 border rounded-xl hidden max-h-96 overflow-y-auto"
    ></div>
  </div>

</div>

<!-- FIREBASE + SEARCH SCRIPT -->
<script type="module">
  /* ---------- LOAD NAVBAR ---------- */
  fetch("navbar.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("navbar").innerHTML = data;
      lucide.createIcons();
    });

  /* ---------- FIREBASE ---------- */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    orderBy,
    startAt,
    endAt,
    getDocs
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBeGZBE1u1-y1hDWbRouchgwkgp89D973I",
    authDomain: "kar-kardan.firebaseapp.com",
    projectId: "kar-kardan",
    storageBucket: "kar-kardan.firebasestorage.app",
    messagingSenderId: "554147696994",
    appId: "1:554147696994:web:221dcb883e3b65dcea5c3b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* ---------- SEARCH ---------- */
  const searchBox = document.getElementById("searchBox");
  const results = document.getElementById("results");

  async function searchPeople(keyword) {
    results.innerHTML = "";
    if (!keyword) {
      results.classList.add("hidden");
      return;
    }

    const q = query(
      collection(db, "users"),
      orderBy("name"),
      startAt(keyword),
      endAt(keyword + "\uf8ff")
    );

    const snap = await getDocs(q);

    if (snap.empty) {
      results.innerHTML = `<p class="p-4 text-gray-500">No users found</p>`;
      results.classList.remove("hidden");
      return;
    }

    snap.forEach(doc => {
      const user = doc.data();

      const div = document.createElement("div");
      div.className =
        "flex items-center gap-3 p-3 hover:bg-blue-50 cursor-pointer";

      div.innerHTML = `
        <img src="${user.photoURL || 'https://via.placeholder.com/40'}"
          class="w-10 h-10 rounded-full object-cover" />
        <div>
          <p class="font-medium">${user.name}</p>
          <p class="text-sm text-gray-500">${user.email || ""}</p>
        </div>
      `;

      div.onclick = () => {
        window.location.href = `profile.html?uid=${doc.id}`;
      };

      results.appendChild(div);
    });

    results.classList.remove("hidden");
  }

  searchBox.addEventListener("input", e => {
    searchPeople(e.target.value.trim());
  });
</script>

</body>
</html>
